<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Goè¯­è¨€ä¸­çš„æ ‡è¯†ç¬¦å¯è§æ€§</title>
      <link href="/2019/10/09/go-yu-yan-zhong-de-biao-shi-fu-ke-jian-xing/"/>
      <url>/2019/10/09/go-yu-yan-zhong-de-biao-shi-fu-ke-jian-xing/</url>
      
        <content type="html"><![CDATA[<h2 id="Goè¯­è¨€ä¸­çš„æ ‡è¯†ç¬¦å¯è§æ€§"><a href="#Goè¯­è¨€ä¸­çš„æ ‡è¯†ç¬¦å¯è§æ€§" class="headerlink" title="Goè¯­è¨€ä¸­çš„æ ‡è¯†ç¬¦å¯è§æ€§"></a>Goè¯­è¨€ä¸­çš„æ ‡è¯†ç¬¦å¯è§æ€§</h2><p>Goè¯­è¨€ä¸­å˜é‡é¦–å­—æ¯å¤§å†™ï¼Œä»£è¡¨å…¶å¯¹å…¶ä»–åŒ…å¯è§ï¼Œåä¹‹ä»£è¡¨ä¸å¯è§ã€‚å…·ä½“åˆ°å®é™…ä½¿ç”¨ä¸­ï¼Œæœ‰å¦‚ä¸‹ä¸€äº›ä½“ç°ã€‚</p><h3 id="1-åŒåŒ…çš„å¯è§æ€§"><a href="#1-åŒåŒ…çš„å¯è§æ€§" class="headerlink" title="1. åŒåŒ…çš„å¯è§æ€§"></a>1. åŒåŒ…çš„å¯è§æ€§</h3><p>åŒä¸€ä¸ªåŒ…å†…ä»£ç çš„æ ‡è¯†ç¬¦å§‹ç»ˆå…·æœ‰å¯è§æ€§ã€‚ä¾‹å¦‚åœ¨<code>main</code>åŒ…ä¸‹é¢æœ‰ä¸¤ä¸ªgoæ–‡ä»¶ï¼Œåˆ†åˆ«ä¸º<code>computer.go</code>ä¸<code>mian.go</code>ï¼Œä»£ç åˆ†åˆ«å¦‚ä¸‹ï¼š</p><pre class=" language-go"><code class="language-go"><span class="token comment" spellcheck="true">// computer.go</span><span class="token keyword">package</span> main<span class="token keyword">type</span> computer <span class="token keyword">struct</span> <span class="token punctuation">{</span>    brand <span class="token builtin">string</span><span class="token punctuation">}</span></code></pre><pre class=" language-go"><code class="language-go"><span class="token comment" spellcheck="true">// main.go</span><span class="token keyword">package</span> main<span class="token keyword">import</span> <span class="token string">"fmt"</span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    computer <span class="token operator">:=</span> computer<span class="token punctuation">{</span><span class="token string">"åç¡•"</span><span class="token punctuation">}</span>    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>computer<span class="token punctuation">.</span>brand<span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre><p>ä¸Šè¿°ä»£ç çš„ç›®çš„æ˜¯æ‰“å°å‡ºç”µè„‘çš„å“ç‰Œä¿¡æ¯ï¼Œæµ‹è¯•æ‰§è¡Œä¸ä¼šæœ‰ä»»ä½•é—®é¢˜ï¼Œå¯è§åŒåŒ…ä¸‹çš„å˜é‡æ˜¯å§‹ç»ˆå¯è§çš„ã€‚</p><h3 id="2-ä¸åŒåŒ…çš„å¯è§æ€§"><a href="#2-ä¸åŒåŒ…çš„å¯è§æ€§" class="headerlink" title="2. ä¸åŒåŒ…çš„å¯è§æ€§"></a>2. ä¸åŒåŒ…çš„å¯è§æ€§</h3><p>ç°åœ¨ï¼Œå°†<strong>1</strong>ä¸­ä»£ç çš„computer.goè½¬ç§»è‡³computeråŒ…ä¸‹ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><pre class=" language-go"><code class="language-go"><span class="token comment" spellcheck="true">// computer.go</span><span class="token keyword">package</span> computer<span class="token keyword">type</span> computer <span class="token keyword">struct</span> <span class="token punctuation">{</span>    brand <span class="token builtin">string</span><span class="token punctuation">}</span></code></pre><p>æ­¤æ—¶å³ä¾¿æ˜¯<code>main.go</code>æ–‡ä»¶ä¸­å¼•å…¥äº†computeråŒ…ä¹Ÿæ— æ³•ä½¿ç”¨computerç»“æ„åŠå…¶å±æ€§ï¼Œç¼–è¯‘å™¨æç¤º<code>Unexported type &#39;computer&#39; usage</code>å¼‚å¸¸ï¼Œå› ä¸ºæ­¤å¤„computeråŠå…¶å±æ€§éƒ½æ²¡æœ‰å¤§å†™é¦–å­—æ¯ï¼Œå› æ­¤æ— æ³•å†è¢«è®¿é—®ï¼Œä¿®æ”¹åçš„ä»£ç åº”è¯¥å¦‚ä¸‹ï¼š</p><pre class=" language-go"><code class="language-go"><span class="token comment" spellcheck="true">// computer.go</span><span class="token keyword">package</span> computer<span class="token keyword">type</span> Computer <span class="token keyword">struct</span> <span class="token punctuation">{</span>    Brand <span class="token builtin">string</span><span class="token punctuation">}</span></code></pre><pre class=" language-go"><code class="language-go"><span class="token comment" spellcheck="true">// main.go</span><span class="token keyword">package</span> main<span class="token keyword">import</span> <span class="token punctuation">(</span>    <span class="token string">"fmt"</span>    <span class="token string">"tests/computer"</span><span class="token punctuation">)</span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    computer <span class="token operator">:=</span> computer<span class="token punctuation">.</span>Computer<span class="token punctuation">{</span><span class="token string">"åç¡•"</span><span class="token punctuation">}</span>    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>computer<span class="token punctuation">.</span>Brand<span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre><p>äº‹å®ä¸Šï¼Œè¿˜å¯ä»¥åœ¨<code>computer.go</code>ä¸­åˆ›å»ºå·¥å‚å‡½æ•°è¿”å›computerå¯¹è±¡ï¼Œå¹¶ä¸”computerå¯¹è±¡åŠå…¶å±æ€§å¹¶ä¸éœ€è¦æš´éœ²å‡ºå»ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><pre class=" language-go"><code class="language-go"><span class="token comment" spellcheck="true">//computer.go</span><span class="token keyword">package</span> computer<span class="token keyword">type</span> computer <span class="token keyword">struct</span> <span class="token punctuation">{</span>    brand <span class="token builtin">string</span><span class="token punctuation">}</span><span class="token keyword">func</span> <span class="token function">New</span><span class="token punctuation">(</span>brand <span class="token builtin">string</span><span class="token punctuation">)</span> computer <span class="token punctuation">{</span>    <span class="token keyword">return</span> computer<span class="token punctuation">{</span>brand<span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å°½ç®¡è¿™æ ·åšç¼–è¯‘å¹¶æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯åœ¨mainå‡½æ•°ä¸­å®é™…ä»ä¸èƒ½é€šè¿‡computer.brandè·å–computerçš„å€¼ï¼Œå¯¹äºå±æ€§è€Œè¨€ï¼Œè¿™é‡Œçš„<code>brand</code>ä»æ—§éœ€è¦å¯¹å¤–æš´éœ²ã€‚åŒæ—¶éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ­¤ç§å†™æ³•IDEä¼šæœ‰è­¦å‘Šï¼š<code>Exported function with unexported type</code>ã€‚</p><p>è¿™é‡Œå…¶å®ä¸»è¦æ€è€ƒçš„æ˜¯è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼šä¸ºä»€ä¹ˆæ²¡æœ‰æš´éœ²çš„å¯¹è±¡å¯ä»¥åœ¨å…¶ä»–ç±»ä¸­è¢«è·å–åˆ°ï¼Ÿ</p><p>å¯¹æ¯”Javaè¯­è¨€ï¼Œå…¶å®æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼Œå¯¹äºåŒ…å†…å¯è§çš„ç±»ä¸å±æ€§ï¼Œè™½ç„¶å¯ä»¥é€šè¿‡å…¶ä»–ç±»è·å–åˆ°ï¼Œä½†æ˜¯ä»ç„¶ä¸èƒ½è°ƒç”¨ç±»ä¸­çš„æ–¹æ³•å¯¹ç±»è¿›è¡Œæ“ä½œã€‚</p><p>æŒ‰ç…§<code>ã€ŠGoè¯­è¨€å®æˆ˜ï¼ˆä¸­æ–‡ç‰ˆï¼‰ã€‹</code>ä¸€ä¹¦ä¸­ç»™å‡ºçš„è§£é‡Šæ˜¯ï¼Œè¦è®©è¿™ä¸ªè¡Œä¸ºå¯è¡Œï¼Œéœ€è¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š</p><blockquote><p>ç¬¬ä¸€ï¼Œå…¬å¼€æˆ–è€…æœªå…¬å¼€çš„æ ‡è¯†ç¬¦ï¼Œä¸æ˜¯ä¸€ä¸ªå€¼</p><p>ç¬¬äºŒï¼ŒçŸ­å˜é‡å£°æ˜æ“ä½œç¬¦ï¼Œæœ‰èƒ½åŠ›æ•è·å¼•ç”¨çš„ç±»å‹ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªæœªå…¬å¼€çš„ç±»å‹çš„å˜é‡ã€‚</p><p>æ°¸è¿œä¸èƒ½æ˜¾ç¤ºåˆ›å»ºä¸€ä¸ªæœªå…¬å¼€çš„å˜é‡ï¼Œä¸è¿‡çŸ­å˜é‡å£°æ˜æ“ä½œç¬¦å¯ä»¥è¿™ä¹ˆåšã€‚</p></blockquote><h3 id="3-å†…åµŒå¯¹è±¡çš„å¯è§æ€§"><a href="#3-å†…åµŒå¯¹è±¡çš„å¯è§æ€§" class="headerlink" title="3. å†…åµŒå¯¹è±¡çš„å¯è§æ€§"></a>3. å†…åµŒå¯¹è±¡çš„å¯è§æ€§</h3><p>å†…åµŒå¯¹è±¡å¦‚æœæœ¬èº«å¯è§ï¼Œé‚£è·Ÿä¹‹å‰çš„æè¿°å·®ä¸å¤šï¼Œå°±ä¸å†èµ˜è¿°ã€‚è¿™é‡Œä¸»è¦æè¿°ä¸‹å†…åµŒå¯¹è±¡æœ¬èº«ä¸å¯è§çš„æƒ…å†µã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸Šè¿°<code>computer</code>ç»“æ„ä¸­å¢åŠ ä¸€ä¸ªç±»å‹ä¸º<code>screen</code>çš„ç»“æ„ï¼š</p><pre class=" language-go"><code class="language-go"><span class="token comment" spellcheck="true">// computer.go</span><span class="token keyword">package</span> computer<span class="token keyword">type</span> Computer <span class="token keyword">struct</span> <span class="token punctuation">{</span>    screen    Brand <span class="token builtin">string</span><span class="token punctuation">}</span><span class="token keyword">type</span> screen <span class="token keyword">struct</span> <span class="token punctuation">{</span>    Brand <span class="token builtin">string</span>    Size <span class="token builtin">int</span><span class="token punctuation">}</span></code></pre><p>è¿™é‡Œçš„screenæ˜¯æ²¡æœ‰å¯¹å¤–æš´éœ²çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬ä¸èƒ½åƒä¸‹é¢è¿™æ ·æ¥åˆå§‹åŒ–ä¸€ä¸ªcomputerå¯¹è±¡ï¼š</p><pre class=" language-go"><code class="language-go">    computer <span class="token operator">:=</span> computer<span class="token punctuation">.</span>Computer <span class="token punctuation">{</span>        Brand<span class="token punctuation">:</span> <span class="token string">"åç¡•"</span><span class="token punctuation">,</span>        screen<span class="token punctuation">:</span> computer<span class="token punctuation">.</span>screen <span class="token punctuation">{</span>            Size<span class="token punctuation">:</span> <span class="token number">24</span><span class="token punctuation">,</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span></code></pre><p>ä½†æ˜¯åˆ©ç”¨Goè¯­è¨€çš„ç‰¹æ€§ï¼Œå°½ç®¡screenæœ¬èº«æ²¡æœ‰å¯¹å¤–æš´éœ²ï¼Œä½†æ˜¯å…¶å±æ€§å´ä»¥å¯¹å¤–æš´éœ²çš„å½¢å¼è¢«æå‡åˆ°äº†computerä¸­ï¼Œæ‰€ä»¥å¯ä»¥è¿™æ ·å¯¹å…¶èµ‹å€¼ï¼š</p><pre class=" language-go"><code class="language-go"><span class="token keyword">package</span> main<span class="token keyword">import</span> <span class="token punctuation">(</span>    <span class="token string">"fmt"</span>    <span class="token string">"tests/computer"</span><span class="token punctuation">)</span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    computer <span class="token operator">:=</span> computer<span class="token punctuation">.</span>Computer <span class="token punctuation">{</span>        Brand<span class="token punctuation">:</span> <span class="token string">"åç¡•"</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span>    computer<span class="token punctuation">.</span>Size <span class="token operator">=</span> <span class="token number">24</span>    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>computer<span class="token punctuation">.</span>Size<span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>Goè¯­è¨€ä¸­é€šè¿‡å­—æ¯å¤§å°å†™æ¥åˆ¤å®šæ˜¯å¦å¯ä»¥å¯¹å¤–è®¿é—®ã€‚ä½†ä¸å¯è®¿é—®ä¸ç­‰äºä¸å¯è·å–ï¼ŒåŒæ ·çš„ï¼Œç»“æ„ä¸å¯è®¿é—®ä¸ç­‰äºå±æ€§ä¸å¯è®¿é—®ï¼Œåœ¨å®é™…ä½¿ç”¨ä¸­éœ€è¦ä»”ç»†ç”„åˆ«ã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p>ã€ŠGoè¯­è¨€å®æˆ˜ã€‹</p>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®°ä¸€æ¬¡å‡çº§SpringCloud Gatewayè·¯ç”±è½¬å‘çš„é—®é¢˜</title>
      <link href="/2019/09/20/ji-yi-ci-sheng-ji-springcloud-gateway-lu-you-zhuan-fa-de-wen-ti/"/>
      <url>/2019/09/20/ji-yi-ci-sheng-ji-springcloud-gateway-lu-you-zhuan-fa-de-wen-ti/</url>
      
        <content type="html"><![CDATA[<h2 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h2><p>æœ¬æ–‡ä¸­ä½¿ç”¨çš„SpringBootç‰ˆæœ¬ï¼š2.1.7.RELEASEï¼ŒSpringCloudä¾èµ–ç‰ˆæœ¬ï¼šGreenwich.SR3ã€‚</p><h2 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h2><p>åœ¨é…ç½®ä¸€ä¸ªç®€å•çš„è·¯ç”±è½¬å‘æ—¶ï¼ŒåŒæ ·çš„é…ç½®ï¼Œè½¬å‘åˆ°äº†ä¸åŒçš„è·¯å¾„ã€‚é…ç½®å¦‚ä¸‹ï¼š</p><pre class=" language-yml"><code class="language-yml">spring:  cloud:    gateway:      routes:        - id: baidu_route          uri: https://baidu.com:443/          predicates:            - Path=/baidu</code></pre><p>ç›®çš„æ˜¯æƒ³å½“è®¿é—®localhost:8080æ—¶ï¼Œè·³è½¬åˆ°<code>https://baidu.com</code>ã€‚ä½†æ˜¯å‡çº§äº†SpringCloudç‰ˆæœ¬åï¼Œå®é™…å´æ˜¯è·³è½¬åˆ°äº†<code>https://baidu.com/baidu</code>ã€‚å¹¶ä¸”è«åå…¶å¦™çš„ä½¿ç”¨æµè§ˆå™¨è®¿é—®ä¸è¿›å…¥æ–­ç‚¹ï¼Œä½¿ç”¨Postmanå‘è¯·æ±‚ç¡®å¯ä»¥è¿›å…¥ï¼Œå¾ˆå¥‡æ€ªã€‚</p><h2 id="é—®é¢˜åŸå› "><a href="#é—®é¢˜åŸå› " class="headerlink" title="é—®é¢˜åŸå› "></a>é—®é¢˜åŸå› </h2><p>é¦–å…ˆå›é¡¾ä¸‹SpringCloud Gatewayçš„å·¥ä½œåŸç†å›¾ï¼š<br><img src="https://s2.ax1x.com/2019/09/20/nObDL4.png" alt="SpringCloud Gateway å·¥ä½œåŸç†"><br>ä»å›¾ä¸Šå¯ä»¥å¾—çŸ¥ï¼Œåœ¨è¿›å…¥æ‰§è¡Œè¿‡æ»¤å™¨ä¹‹å‰ï¼Œéœ€è¦åšè·¯ç”±åŒ¹é…ï¼Œæ‰€ä»¥ç†è®ºä¸Šä¸ä¼šåœ¨æ‰§è¡Œè¿‡æ»¤å™¨ä¹‹å‰å°±å·²ç»å¯¹è·¯ç”±åœ°å€åšäº†ä¿®æ”¹ï¼Œå¤„ç†è¿‡ç¨‹åº”è¯¥å‘ç”Ÿåœ¨Filter Chainä¸­ã€‚</p><p>ç”±äºæœ¬æ–‡æ²¡æœ‰é‡‡ç”¨ä»»ä½•è‡ªå®šä¹‰çš„Filterï¼Œå› æ­¤å›¾ä¸­æ‰§è¡Œçš„Filteréƒ½æ˜¯GlobalFiltersã€‚å¯ä»¥é€šè¿‡Debugæˆ–è€…é›†æˆactuatorçš„æ–¹å¼ï¼ŒæŸ¥çœ‹å…·ä½“æ‰§è¡Œäº†å“ªäº›Filterï¼š</p><pre class=" language-json"><code class="language-json"><span class="token punctuation">{</span><span class="token property">"org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@303c55fa"</span><span class="token operator">:</span>-<span class="token number">2147482648</span><span class="token punctuation">,</span><span class="token property">"org.springframework.cloud.gateway.config.GatewayNoLoadBalancerClientAutoConfiguration$NoLoadBalancerClientFilter@1319bc2a"</span><span class="token operator">:</span><span class="token number">10100</span><span class="token punctuation">,</span><span class="token property">"org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@b0fd744"</span><span class="token operator">:</span><span class="token number">10000</span><span class="token punctuation">,</span><span class="token property">"org.springframework.cloud.gateway.filter.NettyRoutingFilter@502a4156"</span><span class="token operator">:</span><span class="token number">2147483647</span><span class="token punctuation">,</span><span class="token property">"org.springframework.cloud.gateway.filter.ForwardRoutingFilter@92d1782"</span><span class="token operator">:</span><span class="token number">2147483647</span><span class="token punctuation">,</span><span class="token property">"org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@72976b4"</span><span class="token operator">:</span><span class="token number">2147483646</span><span class="token punctuation">,</span><span class="token property">"org.springframework.cloud.gateway.filter.RemoveCachedBodyFilter@64e1377c"</span><span class="token operator">:</span>-<span class="token number">2147483648</span><span class="token punctuation">,</span><span class="token property">"org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@5416f8db"</span><span class="token operator">:</span>-<span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"org.springframework.cloud.gateway.filter.ForwardPathFilter@6a1ef65c"</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">"org.springframework.cloud.gateway.filter.GatewayMetricsFilter@726934e2"</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">}</span></code></pre><p>æŒ‰ç…§æ‰§è¡Œé¡ºåºä»åå¾€å‰æ‰“æ–­ç‚¹å‘ç°ï¼Œå¯¹äºURIçš„å¤„ç†ä¸»è¦å‘ç”Ÿåœ¨RouteToRequestUrlFilterä¸­ã€‚å¯¹æ¯”æ–°æ—§ç‰ˆæœ¬çš„ä»£ç å¯ä»¥å‘ç°ï¼Œæœ€æ–°ç‰ˆçš„ä»£ç ä¸­æœ‰è¿™æ ·ä¸€æ®µä»£ç ï¼š</p><pre class=" language-java"><code class="language-java">URI mergedUrl <span class="token operator">=</span> UriComponentsBuilder<span class="token punctuation">.</span><span class="token function">fromUri</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">scheme</span><span class="token punctuation">(</span>routeUri<span class="token punctuation">.</span><span class="token function">getScheme</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">host</span><span class="token punctuation">(</span>routeUri<span class="token punctuation">.</span><span class="token function">getHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">port</span><span class="token punctuation">(</span>routeUri<span class="token punctuation">.</span><span class="token function">getPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>encoded<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toUri</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>exchange<span class="token punctuation">.</span><span class="token function">getAttributes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>GATEWAY_REQUEST_URL_ATTR<span class="token punctuation">,</span> mergedUrl<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>è€Œä¸ä¹‹å¯¹åº”çš„æ—§ç‰ˆæœ¬ä¸­ä»£ç å¦‚ä¸‹ï¼š</p><pre class=" language-java"><code class="language-java">URI mergedUrl <span class="token operator">=</span> UriComponentsBuilder<span class="token punctuation">.</span><span class="token function">fromUri</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span>routeUri<span class="token punctuation">)</span><span class="token punctuation">;</span>exchange<span class="token punctuation">.</span><span class="token function">getAttributes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>GATEWAY_REQUEST_URL_ATTR<span class="token punctuation">,</span> mergedUrl<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>å…¶ä¸­å‚æ•°uriä¸ºé…ç½®æ–‡ä»¶ä¸­predicatesçš„Pathè·¯å¾„ï¼ŒrouteUriä¸ºé…ç½®æ–‡ä»¶ä¸­çš„uriå‚æ•°ã€‚ç”±æ­¤å¯è§ï¼Œåœ¨æ—§ç‰ˆæœ¬ä»£ç ä¸­ï¼Œé‡å®šå‘çš„åœ°å€å³ä¸ºé…ç½®æ–‡ä»¶çš„uriï¼Œè€Œåœ¨æ–°ç‰ˆæœ¬ä¸­ï¼Œå°†Pathä¸uriè¿›è¡Œäº†æ•´åˆã€‚è‡³æ­¤ï¼ŒçœŸç›¸å¤§ç™½ã€‚</p><h2 id="ä¿®æ”¹å¤„ç†"><a href="#ä¿®æ”¹å¤„ç†" class="headerlink" title="ä¿®æ”¹å¤„ç†"></a>ä¿®æ”¹å¤„ç†</h2><p>å¦‚æœåœ¨å®é™…çš„æƒ…å†µä¸­ï¼Œç¡®å®æœ‰è¿™ä¹ˆä¸€ç§æƒ…å†µï¼šé‡å®šå‘çš„URIä¸åŸå§‹è®¿é—®çš„URIè·¯ç”±ä¸ä¸€è‡´ï¼Œè¯¥æ€ä¹ˆè§£å†³å‘¢ï¼Ÿ<br>é¦–å…ˆæƒ³åˆ°çš„æ˜¯æŸ¥çœ‹æ˜¯å¦èƒ½å¤Ÿæ’é™¤éƒ¨åˆ†é»˜è®¤æ‰§è¡Œçš„GlobalFilterï¼Œå¾ˆé—æ†¾æˆ‘å¹¶æ²¡æœ‰æ‰¾åˆ°ç›¸å…³é…ç½®ã€‚å¹¶ä¸”æŸ¥çœ‹BeanåŠ è½½è¿‡ç¨‹å¯ä»¥å‘ç°ï¼Œåªæœ‰éƒ¨åˆ†GlobalFilterä¸ä¾èµ–ç±»æœ‰å…³ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯ä¸ä¾èµ–äºä»»ä½•é…ç½®åŠ è½½çš„ã€‚æ­¤éƒ¨åˆ†æºç ä½äº<code>GatewayAutoConfiguration</code>ç±»ä¸­ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥è‡ªè¡ŒæŸ¥çœ‹ã€‚</p><p>æ—¢ç„¶æ— æ³•æ’é™¤ï¼Œé‚£ç¬¬äºŒä¸ªåŠæ³•å°±æ˜¯é‡‡ç”¨è‡ªå®šä¹‰çš„Filterè¿›è¡Œå¤„ç†ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œå¯ä»¥åœ¨<code>RouteToRequestUrlFilter</code>æ‰§è¡Œä¹‹å‰æ‰‹åŠ¨å°†Pathç½®ç©ºæˆ–è€…åœ¨å…¶ä¹‹åé‡æ–°å¤„ç†URIï¼Œå…³é”®ä»£ç åˆ†åˆ«å¦‚ä¸‹ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// ç½®ç©ºPath</span>log<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">"MyFilter start"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>exchange <span class="token operator">=</span> exchange<span class="token punctuation">.</span><span class="token function">mutate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span>exchange<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mutate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> chain<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// é‡æ–°å¤„ç†URI</span>Route route <span class="token operator">=</span> exchange<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span>GATEWAY_ROUTE_ATTR<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>route <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> chain<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>log<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">"MyFilter start"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>URI uri <span class="token operator">=</span> exchange<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getURI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">boolean</span> encoded <span class="token operator">=</span> <span class="token function">containsEncodedParts</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span><span class="token punctuation">;</span>URI routeUri <span class="token operator">=</span> route<span class="token punctuation">.</span><span class="token function">getUri</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>URI mergedUrl <span class="token operator">=</span> UriComponentsBuilder<span class="token punctuation">.</span><span class="token function">fromUri</span><span class="token punctuation">(</span>routeUri<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>encoded<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toUri</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>exchange<span class="token punctuation">.</span><span class="token function">getAttributes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>GATEWAY_REQUEST_URL_ATTR<span class="token punctuation">,</span> mergedUrl<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> chain<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>å½“ç„¶é’ˆå¯¹å…·ä½“æƒ…å†µå…·ä½“åˆ†æï¼Œè¿™é‡Œåªæ˜¯æä¾›ä¸€ç§æ€è·¯ã€‚æˆ–è®¸è¿˜æœ‰å…¶ä»–çš„æ–¹å¼å¯ä»¥åšåˆ°ï¼Œè¿™é‡Œæˆ‘ä¹Ÿæ²¡æœ‰è¯»å®Œå®˜æ–¹çš„å…¨éƒ¨æ–‡æ¡£ï¼ˆçœ‹å¾—è„‘å£³ç—›ï¼‰ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å¾®æœåŠ¡ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringCloud </tag>
            
            <tag> Gateway </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å›½å†…ç¯å¢ƒæœ¬åœ°æ­å»ºMinikube</title>
      <link href="/2019/09/05/guo-nei-huan-jing-ben-di-da-jian-minikube/"/>
      <url>/2019/09/05/guo-nei-huan-jing-ben-di-da-jian-minikube/</url>
      
        <content type="html"><![CDATA[<h2 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h2><p>æœ¬æ–‡ä¸­Minikubeç‰ˆæœ¬ä¸ºv1.3.1ï¼ŒDockerç‰ˆæœ¬ä¸º19.03.1ï¼ŒVirtualBoxç‰ˆæœ¬ä¸º6.0.8 r130520 (Qt5.6.3)ã€‚</p><p>æœ¬æ–‡ä¸»è¦è¯´æ˜å¦‚ä½•è§£å†³æ‹‰å–é•œåƒå¤±è´¥çš„é—®é¢˜ï¼Œè‡³äºå…¶ä»–å®‰è£…æ­¥éª¤ï¼Œ<a href="https://minikube.sigs.k8s.io/docs/start/" target="_blank" rel="noopener">å®˜æ–¹æ•™ç¨‹</a>å·²ç»è¯´æ˜çš„éå¸¸è¯¦ç»†ï¼Œæ­¤å¤„ä¸å†èµ˜è¿°ã€‚  </p><p>ç”±äºä¸€äº›ä¼—æ‰€å‘¨çŸ¥çš„åŸå› ï¼Œåœ¨ä½¿ç”¨é»˜è®¤é…ç½®æ­å»ºMinikubeç¯å¢ƒæ—¶ï¼Œå› ä¸ºæ— æ³•æ‹‰å–é•œåƒç­‰é—®é¢˜è€Œå¯¼è‡´å¤±è´¥ã€‚æœ¬æ–‡ä¸»è¦é€šè¿‡ä½¿ç”¨é˜¿é‡Œé•œåƒè¿›è¡Œæ›¿æ¢æ“ä½œã€‚</p><h2 id="æ¥è‡ªæŸåº¦çš„è§£å†³æ–¹æ¡ˆ"><a href="#æ¥è‡ªæŸåº¦çš„è§£å†³æ–¹æ¡ˆ" class="headerlink" title="æ¥è‡ªæŸåº¦çš„è§£å†³æ–¹æ¡ˆ"></a>æ¥è‡ªæŸåº¦çš„è§£å†³æ–¹æ¡ˆ</h2><p>å¦‚æœåœ¨æŸåº¦ä¸Šæœç´¢ï¼Œå¤§éƒ¨åˆ†çš„è§£ç­”å¯èƒ½éƒ½æ˜¯æ‰‹åŠ¨ä»é˜¿é‡Œé•œåƒä»“åº“æ‹‰å–ï¼Œç¼ºä»€ä¹ˆæ‹‰ä»€ä¹ˆï¼Œç„¶åå¯¹Imageé•œåƒé‡æ–°tagã€‚åŒ…æ‹¬æœ€è¿‘åœ¨çœ‹çš„ã€Šé‡æ–°å®šä¹‰Spring Cloudå®æˆ˜ã€‹ä¸€ä¹¦ä¸­ä¹Ÿæ˜¯ä½¿ç”¨æ­¤æ–¹å¼è§£å†³ã€‚ä½†åœ¨æœ€æ–°ç‰ˆæœ¬ç¯å¢ƒä¸‹ï¼Œå¯èƒ½æœ‰å¦‚ä¸‹é•œåƒéœ€è¦æ‰‹åŠ¨æ‹‰å–ï¼š</p><pre><code>k8s.gcr.io/kube-proxy                v1.15.2k8s.gcr.io/kube-apiserver            v1.15.2k8s.gcr.io/kube-scheduler            v1.15.2k8s.gcr.io/kube-controller-manager   v1.15.2k8s.gcr.io/coredns                   1.3.1k8s.gcr.io/etcd                      3.3.10k8s.gcr.io/pause                     3.1</code></pre><p>å³ä¾¿æ˜¯èƒ½è§£å†³é—®é¢˜ï¼Œä¹Ÿä¼šç¨æ˜¾éº»çƒ¦ã€‚</p><h2 id="ä½¿ç”¨é˜¿é‡Œäº‘çš„é•œåƒåŠ é€Ÿè¿›è¡Œæ‹‰å–"><a href="#ä½¿ç”¨é˜¿é‡Œäº‘çš„é•œåƒåŠ é€Ÿè¿›è¡Œæ‹‰å–" class="headerlink" title="ä½¿ç”¨é˜¿é‡Œäº‘çš„é•œåƒåŠ é€Ÿè¿›è¡Œæ‹‰å–"></a>ä½¿ç”¨é˜¿é‡Œäº‘çš„é•œåƒåŠ é€Ÿè¿›è¡Œæ‹‰å–</h2><p>å‚è€ƒé“¾æ¥<a href="https://yq.aliyun.com/articles/221687" target="_blank" rel="noopener">Minikube - Kubernetesæœ¬åœ°å®éªŒç¯å¢ƒ</a></p><p>ä¸»è¦åœ¨Minikubeå¯åŠ¨æ—¶åŠ å…¥å‚æ•°<code>--registry-mirror=https://xxxxxx.mirror.aliyuncs.com(é•œåƒåŠ é€Ÿå™¨åœ°å€)</code>æ¥æ‹‰å–é•œåƒï¼Œå¹¶ä¸”æä¾›äº†ä¸€ä¸ª<a href="https://github.com/AliyunContainerService/minikube" target="_blank" rel="noopener">ä¿®æ”¹ç‰ˆçš„Minikube</a>äºgithubä¸Šã€‚</p><h2 id="ä½¿ç”¨â€“image-repositoryå‚æ•°é…ç½®é•œåƒä»“åº“åœ°å€"><a href="#ä½¿ç”¨â€“image-repositoryå‚æ•°é…ç½®é•œåƒä»“åº“åœ°å€" class="headerlink" title="ä½¿ç”¨â€“image-repositoryå‚æ•°é…ç½®é•œåƒä»“åº“åœ°å€"></a>ä½¿ç”¨â€“image-repositoryå‚æ•°é…ç½®é•œåƒä»“åº“åœ°å€</h2><p>æ­¤æ–¹å¼æ˜¯æˆ‘æœ€åé‡‡ç”¨çš„æ–¹å¼ã€‚åœ¨è¾ƒæ–°ç‰ˆæœ¬çš„Minikubeä¸­ï¼Œå¯ä»¥ä½¿ç”¨æ­¤é…ç½®æ‰§è¡Œé•œåƒä»“åº“åœ°å€ã€‚ä¾‹å¦‚è¿™é‡Œå¯ä»¥æŒ‡å®š<code>--image-repository=registry.cn-hangzhou.aliyuncs.com/google_containers</code>ï¼Œåœ¨å¯åŠ¨æ—¶ï¼Œæ§åˆ¶å°ä¼šæç¤ºä½¿ç”¨è¯¥ä»“åº“æ‹‰å–é•œåƒã€‚å…³äºâ€“image-repositoryï¼Œå®˜æ–¹çš„è¯´æ˜æ˜¯ï¼š</p><blockquote><p>Alternative image repository to pull docker images from. This can be used when you have<br>limited access to gcr.io. Set it to â€œautoâ€ to let minikube decide one for you. For Chinese mainland users, you may use<br>local gcr.io mirrors such as registry.cn-hangzhou.aliyuncs.com/google_containers</p></blockquote><p>æœ€åï¼Œå¯¹äºâ€“registry-mirrorä¸â€“image-repositoryçš„å·®å¼‚ï¼Œå®˜æ–¹ä¹Ÿåœ¨githubä¸Šè¿›è¡Œäº†å›å¤ï¼š<a href="https://github.com/kubernetes/minikube/pull/3714" target="_blank" rel="noopener">#3714</a></p><blockquote><p>I believe â€“registry-mirror only impacts those images with no repository prefix - images that come from the Docker official registry.<br>It wonâ€™t work on images from private registries, which is the case like gcr.io/kube-proxy. For private images, docker will still go to the private registry and fetch them.<br>If you set up minikube with â€“registry-mirror, it could work for pods/deployments that use ubuntu/18.04, but not for gcr.io/ - you will need to wipe the â€œgcr.io/â€œ out from the references to make it look like an image from the official registry. For the latter case, it could be achieved using â€“registry-mirror <a href="https://private_server" target="_blank" rel="noopener">https://private_server</a> â€“image-registry [private_server/]google_containers</p></blockquote><p>æœ€åï¼ŒMinikubeé…ç½®å®Œæˆã€‚</p><pre><code>âœ  ~ minikube start --image-repository=registry.cn-hangzhou.aliyuncs.com/google_containersğŸ˜„  minikube v1.3.1 on Darwin 10.14.4âœ…  Using image repository registry.cn-hangzhou.aliyuncs.com/google_containersğŸ”¥  Creating virtualbox VM (CPUs=2, Memory=2000MB, Disk=20000MB) ...ğŸ³  Preparing Kubernetes v1.15.2 on Docker 18.09.8 ...ğŸšœ  æ‹‰å–é•œåƒ ...ğŸš€  æ­£åœ¨å¯åŠ¨ Kubernetes ...âŒ›  Waiting for: apiserver proxy etcd scheduler controller dnsğŸ„  Done! kubectl is now configured to use &quot;minikube&quot;</code></pre>]]></content>
      
      
      <categories>
          
          <category> å¾®æœåŠ¡ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Minikube </tag>
            
            <tag> Kubernetes </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringCloudå¾®æœåŠ¡ClientException:Load balancer does not have available server for clientå¼‚å¸¸è§£å†³æ–¹æ¡ˆ</title>
      <link href="/2019/08/25/springcloud-wei-fu-wu-clientexception-load-balancer-does-not-have-available-server-for-client-yi-chang-jie-jue-fang-an/"/>
      <url>/2019/08/25/springcloud-wei-fu-wu-clientexception-load-balancer-does-not-have-available-server-for-client-yi-chang-jie-jue-fang-an/</url>
      
        <content type="html"><![CDATA[<h2 id="é‡åˆ°çš„é—®é¢˜"><a href="#é‡åˆ°çš„é—®é¢˜" class="headerlink" title="é‡åˆ°çš„é—®é¢˜"></a>é‡åˆ°çš„é—®é¢˜</h2><p>æœ€è¿‘åœ¨ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„SpringCloudç¼–å†™demoæ—¶å‘ç°çš„é—®é¢˜ã€‚ä½¿ç”¨Feignåœ¨è¿›è¡ŒæœåŠ¡é—´è°ƒç”¨æ—¶ï¼Œä¼šæç¤ºå¼‚å¸¸ï¼š</p><pre class=" language-java"><code class="language-java">ClientException<span class="token operator">:</span>Load balancer does not have available server <span class="token keyword">for</span> xxx</code></pre><p>ä½¿ç”¨çš„ç‰ˆæœ¬ä¸ºï¼š</p><pre class=" language-xml"><code class="language-xml">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.1.7.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencyManagement</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>Greenwich.SR2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">></span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencyManagement</span><span class="token punctuation">></span></span></code></pre><p>æç¤ºä¿¡æ¯å·²ç»å¾ˆæ˜ç¡®äº†ã€‚åœ¨æ—©æœŸçš„Fç‰ˆæœ¬å·¦å³ï¼Œæ­å»ºä¸€ä¸ªç®€å•çš„è°ƒç”¨å®ä¾‹ï¼Œæ˜¯ä¸éœ€è¦æ˜¾ç¤ºçš„æŒ‡æ˜Ribboné…ç½®çš„ï¼Œä½†æ˜¯åœ¨æœ€æ–°çš„ç‰ˆæœ¬ä¸­ï¼Œéœ€è¦ä¸»åŠ¨æŒ‡æ˜å¯ç”¨Ribbonæˆ–å•ç‹¬è¿›è¡Œé…ç½®ã€‚ç°å°†é—®é¢˜è®°å½•äºæ­¤ä»¥ä¾¿æŸ¥é˜…ã€‚</p><h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><h3 id="æ—©æœŸç‰ˆæœ¬å¯èƒ½çš„æ–¹æ¡ˆ"><a href="#æ—©æœŸç‰ˆæœ¬å¯èƒ½çš„æ–¹æ¡ˆ" class="headerlink" title="æ—©æœŸç‰ˆæœ¬å¯èƒ½çš„æ–¹æ¡ˆ"></a>æ—©æœŸç‰ˆæœ¬å¯èƒ½çš„æ–¹æ¡ˆ</h3><p>å¦‚æœåœ¨æŸåº¦ä¸Šæœç´¢è¿™ä¸ªé—®é¢˜ï¼Œå…¶ä¸­ä¹‹ä¸€çš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼Œå¼•å…¥</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-eureka<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>  </code></pre><p>åŒæ ·çš„ï¼Œè¿™å¯èƒ½æ˜¯æ—©æœŸç‰ˆæœ¬çš„è§£å†³æ–¹æ¡ˆï¼Œå¹¶ä¸é€‚ç”¨ç°åœ¨çš„ç‰ˆæœ¬ã€‚äº‹å®ä¸Šï¼Œå¦‚æœå»ä¸­å¤®ä»“åº“ä¸ŠæŸ¥çœ‹è¿™ä¸ªåŒ…ï¼Œä¼šå‘ç°å…¶å·²ç»è¢«æ ‡è®°ä¸º<code>deprecated</code>ï¼Œå¹¶ä¸”æ¨èä½¿ç”¨<code>spring-cloud-starter-netflix-eureka-client</code>æ›¿ä»£ã€‚</p><h3 id="æœ€æ–°ç‰ˆæœ¬çš„æ–¹æ¡ˆ"><a href="#æœ€æ–°ç‰ˆæœ¬çš„æ–¹æ¡ˆ" class="headerlink" title="æœ€æ–°ç‰ˆæœ¬çš„æ–¹æ¡ˆ"></a>æœ€æ–°ç‰ˆæœ¬çš„æ–¹æ¡ˆ</h3><h4 id="æ˜¾ç¤ºçš„å£°æ˜å¯ç”¨Ribbon"><a href="#æ˜¾ç¤ºçš„å£°æ˜å¯ç”¨Ribbon" class="headerlink" title="æ˜¾ç¤ºçš„å£°æ˜å¯ç”¨Ribbon"></a>æ˜¾ç¤ºçš„å£°æ˜å¯ç”¨Ribbon</h4><p>åœ¨æ¶ˆè´¹ç«¯çš„é…ç½®æ–‡ä»¶ä¸­è®¾ç½®ï¼š</p><pre class=" language-yml"><code class="language-yml">ribbon:  eureka:    enabled: true</code></pre><p>æ­¤é¡¹è®¾ç½®ä¼šè‡ªåŠ¨åŸºäºEurekaåšè´Ÿè½½å‡è¡¡ã€‚</p><h4 id="æ‰‹åŠ¨é…ç½®Ribbon"><a href="#æ‰‹åŠ¨é…ç½®Ribbon" class="headerlink" title="æ‰‹åŠ¨é…ç½®Ribbon"></a>æ‰‹åŠ¨é…ç½®Ribbon</h4><p>å¦‚æœé¡¹ç›®ä¸­å¹¶æ²¡æœ‰ä½¿ç”¨Eurekaï¼Œå¯ä»¥æ‰‹åŠ¨è¿›è¡Œé…ç½®æ–‡ä»¶é…ç½®æˆ–è€…ç¼–å†™ä»£ç è¿›è¡Œé…ç½®ã€‚</p><p>é…ç½®æ–‡ä»¶é…ç½®å¦‚ä¸‹ï¼š</p><pre class=" language-yml"><code class="language-yml"># ç”Ÿäº§è€…æœåŠ¡åmicro-service-producer:  ribbon:    # æœåŠ¡åœ°å€    listOfServers: localhost:8200,localhost:8201</code></pre><p>ä»£ç é…ç½®å¦‚ä¸‹ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@RibbonClient</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"micro-service-producer"</span><span class="token punctuation">,</span> configuration <span class="token operator">=</span> RibbonConfig<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RibbonConfig</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String listOfServers <span class="token operator">=</span> <span class="token string">"localhost:8200,localhost:8201"</span><span class="token punctuation">;</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> ServerList<span class="token operator">&lt;</span>Server<span class="token operator">></span> <span class="token function">ribbonServerList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        List<span class="token operator">&lt;</span>Server<span class="token operator">></span> list <span class="token operator">=</span> Lists<span class="token punctuation">.</span><span class="token function">newArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Strings<span class="token punctuation">.</span><span class="token function">isNullOrEmpty</span><span class="token punctuation">(</span>listOfServers<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span>String s<span class="token operator">:</span> listOfServers<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Server</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">StaticServerList</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Server</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä¸Šé¢çš„é—®é¢˜å¯èƒ½å¹¶ä¸æ˜¯å¯¼è‡´è¿™ä¸ªæŠ¥é”™çš„å”¯ä¸€åŸå› ï¼Œä½†åº”è¯¥æ˜¯æœ€æœ‰å¯èƒ½çš„åŸå› ã€‚ç»“åˆç‰ˆæœ¬ã€ä½¿ç”¨çš„æŠ€æœ¯å†ç¡®å®šè§£å†³æ–¹æ¡ˆï¼Œä¸å¯ç›²ç›®ç›¸ä¿¡ç½‘ä¸Šçš„ç­”æ¡ˆã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å¾®æœåŠ¡ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringCloud </tag>
            
            <tag> SpringBoot </tag>
            
            <tag> ribbon </tag>
            
            <tag> feign </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JPAæ˜ å°„æ•°æ®åˆ°éEntityå¯¹è±¡çš„å‡ ç§æ–¹å¼</title>
      <link href="/2019/08/19/jpa-ying-she-shu-ju-dao-fei-entity-dui-xiang-de-ji-chong-fang-shi/"/>
      <url>/2019/08/19/jpa-ying-she-shu-ju-dao-fei-entity-dui-xiang-de-ji-chong-fang-shi/</url>
      
        <content type="html"><![CDATA[<h2 id="1-è¯´æ˜"><a href="#1-è¯´æ˜" class="headerlink" title="1 è¯´æ˜"></a>1 è¯´æ˜</h2><p>æœ¬æ–‡åŸºäºSpringBoot 2.1.7.RELEASEï¼ˆspring-data-jpaç‰ˆæœ¬ï¼š2.1.10.RELEASEï¼‰æ’°å†™ï¼Œä½ç‰ˆæœ¬jpaä¸­çš„æ–¹æ³•å¯èƒ½ä¸æœ€æ–°ç‰ˆä¸­çš„æ–¹æ³•å·®å¼‚è¾ƒå¤§ï¼Œä½†æ€»ä½“æ€è·¯æ²¡æœ‰å¤ªå¤§å˜åŒ–ã€‚æ–‡ä¸­è§‚ç‚¹çš†ä¸ºä¸ªäººè§‚ç‚¹ï¼Œå¦‚æœ‰é”™è¯¯æˆ–è€…æ›´å¥½çš„æ€è·¯ï¼Œæ¬¢è¿æŒ‡æ­£ã€‚</p><h2 id="2-ä¸ºä»€ä¹ˆéœ€è¦æŠŠæ•°æ®æ˜ å°„åˆ°éEntityå¯¹è±¡"><a href="#2-ä¸ºä»€ä¹ˆéœ€è¦æŠŠæ•°æ®æ˜ å°„åˆ°éEntityå¯¹è±¡" class="headerlink" title="2 ä¸ºä»€ä¹ˆéœ€è¦æŠŠæ•°æ®æ˜ å°„åˆ°éEntityå¯¹è±¡"></a>2 ä¸ºä»€ä¹ˆéœ€è¦æŠŠæ•°æ®æ˜ å°„åˆ°éEntityå¯¹è±¡</h2><p>æˆ‘ä»¬çŸ¥é“åœ¨ä½¿ç”¨jpaæŸ¥è¯¢æ•°æ®æ—¶ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹éƒ½æœ‰ä¸€ä¸ªè¢«@Entityæ³¨è§£æ ‡è¯†çš„ç±»ç”¨æ¥ä¸æ•°æ®åº“è¡¨åšæ˜ å°„ï¼Œä½¿ç”¨æ—¶å…ˆæŸ¥è¯¢å‡ºè¿™ä¸ªå¯¹è±¡å†åšä¸€ç³»åˆ—è½¬æ¢ä¼ é€’åˆ°å‰ç«¯ã€‚åœ¨æ­¤ç§æƒ…å†µä¸‹ï¼Œå¦‚æœæŸ¥è¯¢æ–¹æ³•çš„è¿”å›ç»“æœæˆ–è€…å‚æ•°ä¸æ˜¯ä¸€ä¸ªè¢«@Entityæ³¨è§£æ‰€æ ‡è¯†çš„å¯¹è±¡ï¼Œé‚£ä¹ˆå³ä¾¿æ˜¯å­—æ®µæ˜ å°„ä¸Šäº†ï¼Œjpaä»ç„¶ä¼šç»™å‡ºä¸€ä¸ªIllegalArgumentException: Not a managed typeå¼‚å¸¸ã€‚ä½†æ˜¯æœ‰äº›åœºæ™¯ä¸‹ï¼ˆæ¯”å¦‚æŸ¥è¯¢count(id)äº¦æˆ–è€…éœ€è¦å°†å¤šè¡¨çš„å­—æ®µè¿›è¡Œç»„åˆï¼‰æˆ‘ä»¬å¹¶ä¸æ–¹ä¾¿ç›´æ¥åšä¸€ä¸ªå®ä½“ç±»æ¥æ¥æ”¶ï¼Œç”šè‡³æ ¹æœ¬ä¹Ÿæ‰¾ä¸åˆ°èƒ½æ˜ å°„çš„å­—æ®µï¼Œè¿™ä¸ªæ—¶å€™å°±åº”è¯¥è€ƒè™‘å…¶ä»–çš„åŠæ³•äº†ã€‚</p><h2 id="3-æ•°æ®å‡†å¤‡"><a href="#3-æ•°æ®å‡†å¤‡" class="headerlink" title="3 æ•°æ®å‡†å¤‡"></a>3 æ•°æ®å‡†å¤‡</h2><p>æ•°æ®åº“studentè¡¨ä¸scoreè¡¨ï¼Œå¹¶å‡è®¾å…¶ä¸­å·²ç»å­˜åœ¨äº†éƒ¨åˆ†æ•°æ®</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> student<span class="token punctuation">(</span>    id <span class="token keyword">INT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span>  <span class="token keyword">COMMENT</span> <span class="token string">'ä¸»é”®ID'</span> <span class="token punctuation">,</span>    name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span>    <span class="token keyword">COMMENT</span> <span class="token string">'å§“å'</span> <span class="token punctuation">,</span>    sex <span class="token keyword">INT</span>    <span class="token keyword">COMMENT</span> <span class="token string">'æ€§åˆ«ï¼Œ0ï¼šå¥³ï¼›1ï¼šç”·'</span> <span class="token punctuation">,</span>    age <span class="token keyword">INT</span>    <span class="token keyword">COMMENT</span> <span class="token string">'å¹´é¾„'</span> <span class="token punctuation">,</span>    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">COMMENT</span> <span class="token operator">=</span> <span class="token string">' '</span><span class="token punctuation">;</span><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> score<span class="token punctuation">(</span>    id <span class="token keyword">INT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span>  <span class="token keyword">COMMENT</span> <span class="token string">'ä¸»é”®ID'</span> <span class="token punctuation">,</span>    student_id <span class="token keyword">INT</span>    <span class="token keyword">COMMENT</span> <span class="token string">'å­¦ç”ŸID'</span> <span class="token punctuation">,</span>    subject_id <span class="token keyword">INT</span>    <span class="token keyword">COMMENT</span> <span class="token string">'ç§‘ç›® ç§‘ç›®ã€‚0ï¼šè¯­æ–‡ï¼›1ï¼šæ•°å­¦ï¼›2ï¼šè‹±è¯­'</span> <span class="token punctuation">,</span>    score <span class="token keyword">INT</span>    <span class="token keyword">COMMENT</span> <span class="token string">'åˆ†æ•°'</span> <span class="token punctuation">,</span>    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">COMMENT</span> <span class="token operator">=</span> <span class="token string">' '</span><span class="token punctuation">;</span></code></pre><h2 id="4-ç®€å•çš„èšåˆå‡½æ•°æŸ¥è¯¢"><a href="#4-ç®€å•çš„èšåˆå‡½æ•°æŸ¥è¯¢" class="headerlink" title="4 ç®€å•çš„èšåˆå‡½æ•°æŸ¥è¯¢"></a>4 ç®€å•çš„èšåˆå‡½æ•°æŸ¥è¯¢</h2><p>æ¯”å¦‚å½“åªæƒ³æŸ¥è¯¢æ‰€æœ‰æ€§åˆ«ä¸ºç”·çš„åŒå­¦çš„æ•°é‡æ—¶ï¼Œæœ‰ä»¥ä¸‹å‡ ç§å®ç°æ–¹æ¡ˆã€‚å½“ç„¶ï¼Œè¿™é‡Œåªæ˜¯åˆ—ä¸¾äº†æˆ‘æš‚æ—¶èƒ½æƒ³åˆ°çš„å…·æœ‰æ˜æ˜¾å·®å¼‚çš„æ–¹å¼ï¼Œè‡³äºåå‘äºsqlè¿˜æ˜¯hqlï¼Œè¿”å›å¯¹è±¡è¿˜æ˜¯Mapï¼Œå¯ä»¥ç”±è¯»è€…è‡ªè¡Œå‘æ•£ã€‚</p><h3 id="4-1-ä½¿ç”¨countByæ–¹æ³•ä½œä¸ºæŸ¥è¯¢"><a href="#4-1-ä½¿ç”¨countByæ–¹æ³•ä½œä¸ºæŸ¥è¯¢" class="headerlink" title="4.1 ä½¿ç”¨countByæ–¹æ³•ä½œä¸ºæŸ¥è¯¢"></a>4.1 ä½¿ç”¨countByæ–¹æ³•ä½œä¸ºæŸ¥è¯¢</h3><p>ä»¥ä¸‹ä¾¿æ˜¯å…¨éƒ¨çš„ä»£ç ï¼Œå†ç®€å•ä¸è¿‡äº†ã€‚</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">StudentRepo</span> <span class="token keyword">extends</span> <span class="token class-name">CrudRepository</span><span class="token operator">&lt;</span>Student<span class="token punctuation">,</span> Long<span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token keyword">long</span> <span class="token function">countBySex</span><span class="token punctuation">(</span><span class="token keyword">int</span> sex<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h3 id="4-2-ä½¿ç”¨-Queryæ³¨è§£æŸ¥è¯¢"><a href="#4-2-ä½¿ç”¨-Queryæ³¨è§£æŸ¥è¯¢" class="headerlink" title="4.2 ä½¿ç”¨@Queryæ³¨è§£æŸ¥è¯¢"></a>4.2 ä½¿ç”¨@Queryæ³¨è§£æŸ¥è¯¢</h3><p>åŒæ ·å¹¶ä¸å¤æ‚ï¼Œåªæ˜¯æˆ‘ä¸ªäººå¹¶ä¸æ¨èåœ¨å·²ç»ä½¿ç”¨äº†jpaçš„æƒ…å†µä¸‹ç»§ç»­ä½¿ç”¨sqlæˆ–hqlã€‚</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">"SELECT COUNT(id) FROM Student WHERE sex = :sex"</span><span class="token punctuation">)</span><span class="token keyword">long</span> <span class="token function">queryCountBySex</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"sex"</span><span class="token punctuation">)</span> <span class="token keyword">int</span> sex<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="4-3-ä½¿ç”¨EntityManageræ„é€ SQLæˆ–HQLæŸ¥è¯¢"><a href="#4-3-ä½¿ç”¨EntityManageræ„é€ SQLæˆ–HQLæŸ¥è¯¢" class="headerlink" title="4.3 ä½¿ç”¨EntityManageræ„é€ SQLæˆ–HQLæŸ¥è¯¢"></a>4.3 ä½¿ç”¨EntityManageræ„é€ SQLæˆ–HQLæŸ¥è¯¢</h3><p>è¿™ç§æ–¹å¼æ˜æ˜¾æ¯”å‰é¢å‡ ç§éº»çƒ¦äº†è®¸å¤šï¼Œä½†æ˜¯å¥½å¤„æ˜¯å¯¹äºåŠ¨æ€çš„æŸ¥è¯¢æ¡ä»¶æœ‰äº†æ›´å¥½çš„æ”¯æŒã€‚</p><pre class=" language-java"><code class="language-java">String sql <span class="token operator">=</span> <span class="token string">"SELECT COUNT(id) FROM student WHERE sex = ? "</span><span class="token punctuation">;</span>Query countQuery <span class="token operator">=</span> entityManager<span class="token punctuation">.</span><span class="token function">createNativeQuery</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>countQuery<span class="token punctuation">.</span><span class="token function">setParameter</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å­¦ç”Ÿæ•°é‡ï¼š"</span> <span class="token operator">+</span> countQuery<span class="token punctuation">.</span><span class="token function">getSingleResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="4-4-æ„å»ºCriteriaQueryæŸ¥è¯¢"><a href="#4-4-æ„å»ºCriteriaQueryæŸ¥è¯¢" class="headerlink" title="4.4 æ„å»ºCriteriaQueryæŸ¥è¯¢"></a>4.4 æ„å»ºCriteriaQueryæŸ¥è¯¢</h3><p>æœ¬è´¨ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±æ„å»ºä¸€ä¸ªæŸ¥è¯¢è€Œä¸å¿…å»å†™sqlï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œæˆ‘ä»¬â€œå®Œç¾â€çš„è·µè¡Œäº†OOPçš„æ€æƒ³ã€‚</p><pre class=" language-java"><code class="language-java">CriteriaBuilder cb <span class="token operator">=</span> entityManager<span class="token punctuation">.</span><span class="token function">getCriteriaBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>CriteriaQuery<span class="token operator">&lt;</span>Long<span class="token operator">></span> query <span class="token operator">=</span> cb<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span>Long<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Root<span class="token operator">&lt;</span>Student<span class="token operator">></span> root <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>Student<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>query<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span>cb<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>query<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span>cb<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"sex"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">long</span> count <span class="token operator">=</span> entityManager<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSingleResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å­¦ç”Ÿæ•°é‡ï¼š"</span> <span class="token operator">+</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="4-5-ä½¿ç”¨Specificationæ„é€ æŸ¥è¯¢æ¡ä»¶æŸ¥è¯¢"><a href="#4-5-ä½¿ç”¨Specificationæ„é€ æŸ¥è¯¢æ¡ä»¶æŸ¥è¯¢" class="headerlink" title="4.5 ä½¿ç”¨Specificationæ„é€ æŸ¥è¯¢æ¡ä»¶æŸ¥è¯¢"></a>4.5 ä½¿ç”¨Specificationæ„é€ æŸ¥è¯¢æ¡ä»¶æŸ¥è¯¢</h3><p>æœ¬è´¨ä¸Šï¼Œè¿™åº”è¯¥è·Ÿ3.4çš„æ–¹æ³•ä¸€æ ·ï¼Œä½†æ˜¯ä½¿ç”¨Specificationçš„å¥½å¤„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥å°†Specificationä½œä¸ºå‚æ•°ä¼ é€’ç»™æ–¹æ³•ã€‚åªéœ€è¦åœ¨Repositoryé‡Œå®šä¹‰ä¸€ä¸ª<code>long count(Specification&lt;Student&gt; specification);</code>æ–¹æ³•ï¼Œjpaä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬æŸ¥è¯¢ã€‚çœ‹ä¸Šå»ï¼Œè¿™åº”è¯¥æ˜¯æœ€å¤æ‚çš„æ–¹å¼äº†ã€‚çš„ç¡®ï¼Œåœ¨è¿™ä¸ªæ¡ä»¶ä¸‹ï¼Œä½¿ç”¨è¿™ç§æ–¹å¼ç¡®å®æœ‰ç‚¹â€œå¾—ä¸å¿å¤±â€çš„æ„Ÿè§‰ï¼Œä½†å¦‚æœäº‹æƒ…å˜å¾—æ›´åŠ å¤æ‚ï¼Œæˆ‘ä¸ªäººæ˜¯æœ€æ¨å´‡è¿™ç§æ–¹å¼çš„ã€‚</p><pre class=" language-java"><code class="language-java">Specification<span class="token operator">&lt;</span>Student<span class="token operator">></span> studentSpecification <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Specification</span><span class="token operator">&lt;</span>Student<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> Predicate <span class="token function">toPredicate</span><span class="token punctuation">(</span>Root<span class="token operator">&lt;</span>Student<span class="token operator">></span> root<span class="token punctuation">,</span> CriteriaQuery<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> criteriaQuery<span class="token punctuation">,</span>        CriteriaBuilder criteriaBuilder<span class="token punctuation">)</span> <span class="token punctuation">{</span>        criteriaQuery<span class="token punctuation">.</span><span class="token function">multiselect</span><span class="token punctuation">(</span>criteriaBuilder<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> criteriaBuilder<span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span>criteriaBuilder<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"sex"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">long</span> count <span class="token operator">=</span> studentRepo<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span>studentSpecification<span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å­¦ç”Ÿæ•°é‡ï¼š"</span> <span class="token operator">+</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="5-å¤æ‚æƒ…å†µä¸‹çš„æŸ¥è¯¢"><a href="#5-å¤æ‚æƒ…å†µä¸‹çš„æŸ¥è¯¢" class="headerlink" title="5 å¤æ‚æƒ…å†µä¸‹çš„æŸ¥è¯¢"></a>5 å¤æ‚æƒ…å†µä¸‹çš„æŸ¥è¯¢</h2><p>ç°åœ¨æ¥çœ‹ä¸€äº›ç¨å¾®å¤æ‚ç‚¹çš„æƒ…å†µã€‚æ¯”å¦‚ç°åœ¨éœ€è¦ç»Ÿè®¡æ¯ä¸ªå­¦ç”Ÿçš„æ‰€æœ‰ç§‘ç›®çš„æˆç»©æ€»å’Œï¼Œå¦‚æœå†™sqlçš„è¯ï¼Œåº”è¯¥çœ‹ä¸Šå»åƒæ˜¯è¿™æ ·ï¼š</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> st<span class="token punctuation">.</span><span class="token punctuation">`</span>name<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token function">SUM</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>score<span class="token punctuation">)</span> <span class="token keyword">FROM</span> student st <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> score s <span class="token keyword">ON</span> s<span class="token punctuation">.</span>student_id <span class="token operator">=</span> st<span class="token punctuation">.</span>id <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> s<span class="token punctuation">.</span>student_id</code></pre><p>è¿™é‡Œä¸¾è¿™ä¸ªä¾‹å­ï¼Œåªæ˜¯ä¸ºäº†æ–¹ä¾¿è¯´æ˜åšçš„ä¸€ä¸ªç®€å•ä¸¾ä¾‹ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬ç¡®å®éœ€è¦åšè¿™æ ·çš„ç»Ÿè®¡ï¼šå®ƒä»¬æ—¢ä¸æ–¹ä¾¿åšæˆå•ç‹¬çš„å®ä½“ï¼Œä¹Ÿä¸æ–¹ä¾¿åšå¤šæ¬¡æŸ¥è¯¢æ¥å¤„ç†ã€‚åœ¨è¿™ä¸ªæ¡ä»¶ä¸‹ï¼Œè¿˜èƒ½ä½¿ç”¨ä¹‹å‰çš„é‚£äº›æ–¹å¼ä¹ˆï¼Ÿäº‹å®ä¸Šï¼Œé™¤äº†3.1è·Ÿ3.5ä¸­çš„æ–¹å¼ï¼ˆæ®æˆ‘è‡ªå·±äº†è§£ï¼‰ï¼Œå…¶ä»–éƒ½æ˜¯å¯ä»¥å®ç°çš„ã€‚</p><p>åœ¨è¿™ç§æ¡ä»¶ä¸‹ï¼Œåº”è¯¥æœ‰ä¸€ä¸ªç±»ç”¨äºæ¥æ”¶æŸ¥è¯¢ç»“æœï¼ˆé@Entityæ³¨è§£çš„ç±»ï¼‰ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Getter</span><span class="token annotation punctuation">@Setter</span><span class="token annotation punctuation">@AllArgsConstructor</span><span class="token annotation punctuation">@NoArgsConstructor</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StudentScore</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>    <span class="token keyword">private</span> Long totalScore<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>æ¥ä¸‹æ¥çœ‹çœ‹ä¸Šé¢çš„æ–¹æ³•éƒ½æ¥å¦‚ä½•æ”¹è¿›ã€‚</p><h3 id="5-1-ä½¿ç”¨-Queryæ³¨è§£æŸ¥è¯¢æ”¹è¿›"><a href="#5-1-ä½¿ç”¨-Queryæ³¨è§£æŸ¥è¯¢æ”¹è¿›" class="headerlink" title="5.1 ä½¿ç”¨@Queryæ³¨è§£æŸ¥è¯¢æ”¹è¿›"></a>5.1 ä½¿ç”¨@Queryæ³¨è§£æŸ¥è¯¢æ”¹è¿›</h3><p>ä»ä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼Œ@Queryèƒ½å¤Ÿä½¿ç”¨æ„é€ æ–¹æ³•å¯¹å‚æ•°è¿›è¡Œæ³¨å…¥ã€‚è¿™æ˜¯å…¶å®ç°çš„æ–¹å¼ä¹‹ä¸€ã€‚</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">"SELECT new com.jptangchina.jpa.StudentScore(st.name, SUM(s.score)) FROM Student st LEFT JOIN Score s ON s.studentId = st.id GROUP BY s.studentId"</span><span class="token punctuation">)</span>List<span class="token operator">&lt;</span>StudentScore<span class="token operator">></span> <span class="token function">queryStudentScore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>è™½ç„¶æ­¤æ–¹å¼èƒ½å¤Ÿå®ç°ç›®æ ‡åŠŸèƒ½ï¼Œä½†æ˜¯å¯¹äºä¸€äº›å¤æ‚åœºæ™¯çš„åŠ¨æ€SQLæ”¯æŒæ¬ ä½³ï¼Œå†µä¸”æˆ‘ä¸ªäººå®åœ¨ä¸æ„¿çœ‹åˆ°ä»£ç é‡Œé¢æ—¢æœ‰sqlåˆæœ‰æ–¹æ³•ï¼Œæ‰€ä»¥å¹¶ä¸æ¨èã€‚</p><h3 id="5-2-ä½¿ç”¨EntityManageræ„é€ SQLæˆ–HQLæŸ¥è¯¢æ–¹æ³•æ”¹è¿›"><a href="#5-2-ä½¿ç”¨EntityManageræ„é€ SQLæˆ–HQLæŸ¥è¯¢æ–¹æ³•æ”¹è¿›" class="headerlink" title="5.2 ä½¿ç”¨EntityManageræ„é€ SQLæˆ–HQLæŸ¥è¯¢æ–¹æ³•æ”¹è¿›"></a>5.2 ä½¿ç”¨EntityManageræ„é€ SQLæˆ–HQLæŸ¥è¯¢æ–¹æ³•æ”¹è¿›</h3><p>ä¸€ç§å¯èƒ½çš„å†™æ³•æ˜¯ï¼š</p><pre class=" language-java"><code class="language-java">String sql <span class="token operator">=</span> <span class="token string">"SELECT st.`name`, SUM(s.score) FROM student st LEFT JOIN score s ON s.student_id = st.id GROUP BY s.student_id"</span><span class="token punctuation">;</span>NativeQuery query <span class="token operator">=</span> entityManager<span class="token punctuation">.</span><span class="token function">createNativeQuery</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span>NativeQuery<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>List<span class="token operator">&lt;</span>StudentScore<span class="token operator">></span> studentScores <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">getResultList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>ä¸è¯´äº†ï¼Œçº¯sqlï¼Œæ’¸å°±å®Œäº‹å„¿äº†ã€‚</p><h3 id="5-3-æ„å»ºCriteriaQueryæŸ¥è¯¢æ–¹æ³•æ”¹è¿›"><a href="#5-3-æ„å»ºCriteriaQueryæŸ¥è¯¢æ–¹æ³•æ”¹è¿›" class="headerlink" title="5.3 æ„å»ºCriteriaQueryæŸ¥è¯¢æ–¹æ³•æ”¹è¿›"></a>5.3 æ„å»ºCriteriaQueryæŸ¥è¯¢æ–¹æ³•æ”¹è¿›</h3><p>ç”±äºè¿™é‡Œç”¨åˆ°äº†å¤šè¡¨è¿æ¥æŸ¥è¯¢ï¼Œå› æ­¤éœ€è¦åœ¨Studentä¸­æŒ‡åä¸Scoreçš„æ˜ å°„å…³ç³»ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@OneToMany</span><span class="token punctuation">(</span>fetch <span class="token operator">=</span> FetchType<span class="token punctuation">.</span>LAZY<span class="token punctuation">)</span><span class="token annotation punctuation">@JoinColumn</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"studentId"</span><span class="token punctuation">,</span> insertable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> updatable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token keyword">private</span> List<span class="token operator">&lt;</span>Score<span class="token operator">></span> scores<span class="token punctuation">;</span></code></pre><p>ç„¶åä»£ç å¯ä»¥è¿™æ ·æ”¹è¿›ï¼š</p><pre class=" language-java"><code class="language-java">CriteriaBuilder cb <span class="token operator">=</span> entityManager<span class="token punctuation">.</span><span class="token function">getCriteriaBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>CriteriaQuery<span class="token operator">&lt;</span>StudentScore<span class="token operator">></span> query <span class="token operator">=</span> cb<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span>StudentScore<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Root<span class="token operator">&lt;</span>Student<span class="token operator">></span> root <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>Student<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Join<span class="token operator">&lt;</span>Student<span class="token punctuation">,</span> Score<span class="token operator">></span> scoreJoin <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token function">joinList</span><span class="token punctuation">(</span><span class="token string">"scores"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>query<span class="token punctuation">.</span><span class="token function">multiselect</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cb<span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span>scoreJoin<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"score"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>query<span class="token punctuation">.</span><span class="token function">groupBy</span><span class="token punctuation">(</span>scoreJoin<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"studentId"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>List<span class="token operator">&lt;</span>StudentScore<span class="token operator">></span> studentScores <span class="token operator">=</span> entityManager<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResultList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>è‡³äºä¸ºä»€ä¹ˆ3.5ä¸­çš„æ–¹æ³•ä¸èƒ½å®ç°ï¼Œæˆ‘çœ‹äº†ä¸‹jpaçš„æºç ï¼Œå…¶ä¸­æœ‰è¿™ä¹ˆä¸€æ®µä»£ç ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">protected</span> <span class="token operator">&lt;</span>S <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token operator">></span> TypedQuery<span class="token operator">&lt;</span>S<span class="token operator">></span> <span class="token function">getQuery</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> Specification<span class="token operator">&lt;</span>S<span class="token operator">></span> spec<span class="token punctuation">,</span> Class<span class="token operator">&lt;</span>S<span class="token operator">></span> domainClass<span class="token punctuation">,</span> Sort sort<span class="token punctuation">)</span> <span class="token punctuation">{</span>        CriteriaBuilder builder <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>em<span class="token punctuation">.</span><span class="token function">getCriteriaBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        CriteriaQuery<span class="token operator">&lt;</span>S<span class="token operator">></span> query <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span>domainClass<span class="token punctuation">)</span><span class="token punctuation">;</span>        Root<span class="token operator">&lt;</span>S<span class="token operator">></span> root <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">applySpecificationToCriteria</span><span class="token punctuation">(</span>spec<span class="token punctuation">,</span> domainClass<span class="token punctuation">,</span> query<span class="token punctuation">)</span><span class="token punctuation">;</span>        query<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>sort<span class="token punctuation">.</span><span class="token function">isSorted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            query<span class="token punctuation">.</span><span class="token function">orderBy</span><span class="token punctuation">(</span>QueryUtils<span class="token punctuation">.</span><span class="token function">toOrders</span><span class="token punctuation">(</span>sort<span class="token punctuation">,</span> root<span class="token punctuation">,</span> builder<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">applyRepositoryMethodMetadata</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>em<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span></code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œjpaè‡ªåŠ¨æ„å»ºçš„æŸ¥è¯¢ä¸­ï¼ŒCriteriaQueryä¸Rootçš„æ³›å‹ç±»å‹æ˜¯ä¸€è‡´çš„ï¼Œè€Œé€šè¿‡3.4ä¸­çš„ä»£ç å¯¹æ¯”æ¥çœ‹çš„è¯ï¼ŒCriteriaQueryçš„æ³›å‹ç±»å‹åº”è¯¥ä¸æœ€ç»ˆè¿”å›çš„å¯¹è±¡ä¸€è‡´æ‰å¯¹ï¼Œæ‰€ä»¥å¦‚æœæ²¡æœ‰å…¶ä»–æ–¹æ¡ˆçš„è¯ï¼Œè¿™ä¸ªæ–¹æ³•åº”è¯¥æ˜¯è¡Œä¸é€šçš„ã€‚è€Œå®é™…æƒ…å†µä¸­ï¼Œjpaä¼šæŠ›å‡ºä¸€ä¸ªPropertyReferenceExceptionå¼‚å¸¸ã€‚</p><h2 id="6-æ€»ç»“"><a href="#6-æ€»ç»“" class="headerlink" title="6 æ€»ç»“"></a>6 æ€»ç»“</h2><p>ä»¥ä¸Šçš†ä¸ºä¸ªäººåœ¨å¹³æ—¶å¼€å‘ä¸­é‡åˆ°è¿‡çš„ä¸€äº›é—®é¢˜ï¼Œä½†æ˜¯è¿™é‡Œåšäº†ç®€åŒ–å¤„ç†ã€‚æ€»ä½“æ¥è®²ï¼Œæ—¢ç„¶ä½¿ç”¨äº†jpaï¼Œæˆ‘è®¤ä¸ºå°±å°½å¯èƒ½çš„é¿å…ä»¥sqlçš„å½¢å¼å†å»å¤„ç†æ•°æ®åº“æ“ä½œã€‚</p><p>jpaä¸­æ•°æ®å½“ç„¶ä¹Ÿå¯ä»¥è¿”å›ä¸º<code>List&lt;Object[]&gt;</code>ã€<code>List&lt;Map&lt;String, Object&gt;&gt;</code>çš„å½¢å¼ï¼Œä½†åŒæ ·çš„ï¼Œä¸ªäººè®¤ä¸ºè¿™å·²ç»è¿èƒŒäº†OOPçš„æ€æƒ³ï¼Œæ˜¯ä¸€ç§å¦¥åï¼Œä¸åº”ç§¯æé‡‡ç”¨çš„ï¼Œå¤šä½¿ç”¨Specificationæ‰æ˜¯æ­£é“å“‡ã€‚</p><p>å†æ¬¡å£°æ˜ï¼Œä¸ªäººè§‚ç‚¹ï¼Œæœ‰é”™è¯¯æ¬¢è¿æå‡ºã€‚</p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> jpa </tag>
            
            <tag> æ•°æ®æ˜ å°„ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Gradleç¯å¢ƒä¸‹å¯¼å‡ºSwaggerä¸ºPDF</title>
      <link href="/2019/06/25/gradle-huan-jing-xia-dao-chu-swagger-wei-pdf/"/>
      <url>/2019/06/25/gradle-huan-jing-xia-dao-chu-swagger-wei-pdf/</url>
      
        <content type="html"><![CDATA[<h2 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h2><p>æˆ‘ä¸ªäººæ˜¯ä¸€ç›´ä½¿ç”¨Swaggerä½œä¸ºæ¥å£æ–‡æ¡£çš„è¯´æ˜çš„ã€‚ä½†æ˜¯ç”±äºåœ¨ä¸€äº›æƒ…å†µä¸‹ï¼Œæ¥å£æ–‡æ¡£è¯´æ˜éœ€è¦ä»¥æ–‡ä»¶çš„å½¢å¼äº¤ä»˜å‡ºå»ï¼Œå¦‚æœå†é‡æ–°å†™ä¸€ä»½æ–‡æ¡£éš¾å…æœ‰äº›éº»çƒ¦ã€‚äºæ˜¯åœ¨ç½‘ä¸Šçœ‹åˆ°äº†Swagger2Markup + asciidoctorå¯¼å‡ºPDFçš„æ–¹æ³•ï¼Œç™¾åº¦ä¸€ç•ªåæ„Ÿè§‰ç½‘ä¸Šçš„æ–‡ç« è¿˜æ˜¯æœ‰å¾ˆå¤šæ²¡æœ‰æè¿°æ¸…æ¥šçš„åœ°æ–¹ï¼Œé‚è¿˜æ˜¯ç¡¬ç€å¤´çš®æŠŠå®˜æ–¹çš„è‹±æ–‡æ–‡æ¡£å¤§è‡´æµè§ˆäº†ä¸€ä¸‹ï¼ŒæŒ‰ç…§è‡ªå·±çš„æ€è·¯æ•´ç†å‡ºå…·ä½“çš„æ­¥éª¤ã€‚</p><p>æœ¬æ–‡ç”¨åˆ°çš„å·¥å…·ï¼š</p><ul><li>Gradle - 4.10.3</li><li>SpringBoot - 2.1.6.RELEASE</li><li>Swagger - 2.9.2</li><li>Swagger2Markup - 1.3.3</li><li>asciidoctor</li><li>spring-restdocs-mockmvc</li></ul><h2 id="å‡†å¤‡Swaggeræ•°æ®"><a href="#å‡†å¤‡Swaggeræ•°æ®" class="headerlink" title="å‡†å¤‡Swaggeræ•°æ®"></a>å‡†å¤‡Swaggeræ•°æ®</h2><p>SpringBootä¸­ä½¿ç”¨Swaggerçš„è¿‡ç¨‹å°±ä¸å†èµ˜è¿°äº†ï¼Œä¸‹é¢æ˜¯æœ¬æ–‡ä½¿ç”¨çš„èŒƒä¾‹ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token annotation punctuation">@EnableSwagger2</span><span class="token keyword">class</span> <span class="token class-name">SwaggerConfig</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> Docket <span class="token function">createRestApi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Docket</span><span class="token punctuation">(</span>DocumentationType<span class="token punctuation">.</span>SWAGGER_2<span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">apiInfo</span><span class="token punctuation">(</span><span class="token function">apiInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">apis</span><span class="token punctuation">(</span>RequestHandlerSelectors<span class="token punctuation">.</span><span class="token function">basePackage</span><span class="token punctuation">(</span><span class="token string">"com.jptangchina.gradle.controller"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">paths</span><span class="token punctuation">(</span>PathSelectors<span class="token punctuation">.</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> ApiInfo <span class="token function">apiInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ApiInfoBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">title</span><span class="token punctuation">(</span><span class="token string">"Swagger2Markup Test Api"</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token string">"1.0"</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@RestController</span><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/user"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@Api</span><span class="token punctuation">(</span>tags <span class="token operator">=</span> <span class="token string">"ç”¨æˆ·æ¥å£"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">"ç”¨æˆ·ç™»å½•"</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@ResponseBody</span>    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/login"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> Result<span class="token operator">&lt;</span>Void<span class="token operator">></span> <span class="token function">login</span><span class="token punctuation">(</span>        <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"ç”¨æˆ·å"</span><span class="token punctuation">,</span> example <span class="token operator">=</span> <span class="token string">"jptangchina"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token annotation punctuation">@RequestParam</span> String username<span class="token punctuation">,</span>        <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"å¯†ç "</span><span class="token punctuation">,</span> example <span class="token operator">=</span> <span class="token string">"jptangchina"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token annotation punctuation">@RequestParam</span> String password<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> Result<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h2 id="ä½¿ç”¨org-asciidoctor-convertç”ŸæˆPDFï¼ˆä¸ªäººä¸æ¨èä½¿ç”¨ï¼‰"><a href="#ä½¿ç”¨org-asciidoctor-convertç”ŸæˆPDFï¼ˆä¸ªäººä¸æ¨èä½¿ç”¨ï¼‰" class="headerlink" title="ä½¿ç”¨org.asciidoctor.convertç”ŸæˆPDFï¼ˆä¸ªäººä¸æ¨èä½¿ç”¨ï¼‰"></a>ä½¿ç”¨org.asciidoctor.convertç”ŸæˆPDFï¼ˆä¸ªäººä¸æ¨èä½¿ç”¨ï¼‰</h2><blockquote><p>å®˜æ–¹æ•™ç¨‹åœ°å€ï¼š<a href="https://github.com/Swagger2Markup/spring-swagger2markup-demo" target="_blank" rel="noopener">https://github.com/Swagger2Markup/spring-swagger2markup-demo</a></p></blockquote><p>ä»…ä¸ºäº†ç®€å•çš„å¯¼å‡ºPDFè€Œè¨€ï¼Œæœ¬æ–‡é’ˆå¯¹å®˜æ–¹æ¡ˆä¾‹å‡æœ‰æ‰€æ”¹åŠ¨ï¼Œå»æ‰äº†éƒ¨åˆ†æ²¡æœ‰ç”¨åˆ°çš„é…ç½®ã€‚</p><h3 id="1-è·å–Swagger-jsonæ–‡ä»¶"><a href="#1-è·å–Swagger-jsonæ–‡ä»¶" class="headerlink" title="1. è·å–Swagger jsonæ–‡ä»¶"></a>1. è·å–Swagger jsonæ–‡ä»¶</h3><p>Swaggeré¡µé¢æœ¬è´¨ä¸Šä¹Ÿå°±æ˜¯å¯¹jsonæ–‡ä»¶è¿›è¡Œè§£æã€‚è¿™é‡Œéœ€è¦å…ˆç¼–å†™å•å…ƒæµ‹è¯•è®¿é—®<code>/v2/api-docs</code>æ¥å£å¹¶å°†jsonæ–‡ä»¶ä¿å­˜åˆ°æœ¬åœ°ã€‚</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span>SpringRunner<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token annotation punctuation">@SpringBootTest</span><span class="token annotation punctuation">@AutoConfigureMockMvc</span><span class="token keyword">class</span> <span class="token class-name">SwaggerTest</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> MockMvc mockMvc<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">generateAsciiDocsToFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>        String outputDir <span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"io.springfox.staticdocs.outputDir"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        MvcResult mvcResult <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mockMvc<span class="token punctuation">.</span><span class="token function">perform</span><span class="token punctuation">(</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/v2/api-docs"</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>MediaType<span class="token punctuation">.</span>APPLICATION_JSON<span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isOk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">andReturn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        MockHttpServletResponse response <span class="token operator">=</span> mvcResult<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        String swaggerJson <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getContentAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Files<span class="token punctuation">.</span><span class="token function">createDirectories</span><span class="token punctuation">(</span>Paths<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>outputDir<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">(</span>BufferedWriter writer <span class="token operator">=</span> Files<span class="token punctuation">.</span><span class="token function">newBufferedWriter</span><span class="token punctuation">(</span>Paths<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>outputDir<span class="token punctuation">,</span> <span class="token string">"swagger.json"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> StandardCharsets<span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            writer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>swaggerJson<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><blockquote><p>System.getProperty(â€œio.springfox.staticdocs.outputDirâ€);æ¥è‡ªäºbuild.gradleä¸­çš„é…ç½®</p></blockquote><h3 id="2-å°†jsonæ–‡ä»¶è½¬æ¢ä¸ºadocæ–‡ä»¶"><a href="#2-å°†jsonæ–‡ä»¶è½¬æ¢ä¸ºadocæ–‡ä»¶" class="headerlink" title="2. å°†jsonæ–‡ä»¶è½¬æ¢ä¸ºadocæ–‡ä»¶"></a>2. å°†jsonæ–‡ä»¶è½¬æ¢ä¸ºadocæ–‡ä»¶</h3><p>è½¬æ¢jsonæ–‡ä»¶éœ€è¦ä½¿ç”¨åˆ°<code>io.github.swagger2markup</code>æ’ä»¶çš„<code>convertSwagger2markup</code>æ–¹æ³•ã€‚</p><p>å¼•å…¥ç›¸å…³ä¾èµ–ï¼š</p><pre class=" language-java"><code class="language-java">buildscript <span class="token punctuation">{</span>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    dependencies <span class="token punctuation">{</span>        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>        classpath <span class="token string">'io.github.swagger2markup:swagger2markup-gradle-plugin:1.3.3'</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>apply plugin<span class="token operator">:</span> <span class="token string">'io.github.swagger2markup'</span></code></pre><p>é…ç½®convertSwagger2markupï¼š</p><pre class=" language-java"><code class="language-java">ext <span class="token punctuation">{</span>    asciiDocOutputDir <span class="token operator">=</span> <span class="token function">file</span><span class="token punctuation">(</span><span class="token string">"${buildDir}/asciidoc"</span><span class="token punctuation">)</span>    swaggerOutputDir <span class="token operator">=</span> <span class="token function">file</span><span class="token punctuation">(</span><span class="token string">"${buildDir}/swagger"</span><span class="token punctuation">)</span><span class="token punctuation">}</span>test <span class="token punctuation">{</span>    systemProperty <span class="token string">'io.springfox.staticdocs.outputDir'</span><span class="token punctuation">,</span> swaggerOutputDir<span class="token punctuation">}</span>convertSwagger2markup <span class="token punctuation">{</span>    dependsOn test    swaggerInput <span class="token string">"${swaggerOutputDir}/swagger.json"</span>    outputDir asciiDocOutputDir    config <span class="token operator">=</span> <span class="token punctuation">[</span>            <span class="token string">'swagger2markup.pathsGroupedBy'</span> <span class="token operator">:</span> <span class="token string">'TAGS'</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span><span class="token punctuation">}</span></code></pre><blockquote><p>æ›´å¤šconfigé…ç½®å¯ä»¥å‚è€ƒï¼š<a href="http://swagger2markup.github.io/swagger2markup/1.3.3/#_swagger2markup_properties" target="_blank" rel="noopener">http://swagger2markup.github.io/swagger2markup/1.3.3/#_swagger2markup_properties</a></p></blockquote><h3 id="3-å°†adocæ–‡ä»¶è½¬æ¢ä¸ºPDFæ–‡ä»¶"><a href="#3-å°†adocæ–‡ä»¶è½¬æ¢ä¸ºPDFæ–‡ä»¶" class="headerlink" title="3. å°†adocæ–‡ä»¶è½¬æ¢ä¸ºPDFæ–‡ä»¶"></a>3. å°†adocæ–‡ä»¶è½¬æ¢ä¸ºPDFæ–‡ä»¶</h3><p>è½¬æ¢PDFæ–‡ä»¶éœ€è¦ç”¨åˆ°<code>org.asciidoctor.convert</code>æ’ä»¶çš„<code>asciidoctor</code>æ–¹æ³•ã€‚<br>å¼•å…¥ç›¸å…³ä¾èµ–ï¼š</p><pre class=" language-java"><code class="language-java">buildscript <span class="token punctuation">{</span>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    dependencies <span class="token punctuation">{</span>        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>        classpath <span class="token string">'org.asciidoctor:asciidoctor-gradle-plugin:1.5.3'</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>apply plugin<span class="token operator">:</span> <span class="token string">'org.asciidoctor.convert'</span></code></pre><p><strong>æ‰‹åŠ¨ç¼–å†™</strong>index.adocæ–‡ä»¶ï¼Œæ”¾ç½®åˆ°${asciiDocOutputDir.absolutePath}ä¸­ï¼š</p><pre><code>include::{generated}/overview.adoc[]include::{generated}/paths.adoc[]include::{generated}/definitions.adoc[]include::{generated}/security.adoc[]</code></pre><blockquote><p>{generated}é»˜è®¤å€¼ä¸º${build}/asciidocï¼Œå‚è§ï¼š<a href="https://github.com/Swagger2Markup/swagger2markup-gradle-project-template" target="_blank" rel="noopener">https://github.com/Swagger2Markup/swagger2markup-gradle-project-template</a></p></blockquote><p>é…ç½®asciidoctorï¼š</p><pre class=" language-java"><code class="language-java">asciidoctor <span class="token punctuation">{</span>    dependsOn convertSwagger2markup    <span class="token comment" spellcheck="true">// sourceDirä¸­éœ€è¦åŒ…å«æœ‰ä¹‹å‰æ‰‹åŠ¨ç¼–å†™çš„index.adocæ–‡ä»¶</span>    <span class="token function">sourceDir</span><span class="token punctuation">(</span>asciiDocOutputDir<span class="token punctuation">.</span>absolutePath<span class="token punctuation">)</span>    sources <span class="token punctuation">{</span>        include <span class="token string">"index.adoc"</span>    <span class="token punctuation">}</span>    backends <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'pdf'</span><span class="token punctuation">]</span>    attributes <span class="token operator">=</span> <span class="token punctuation">[</span>            doctype<span class="token operator">:</span> <span class="token string">'book'</span><span class="token punctuation">,</span>            toc<span class="token operator">:</span> <span class="token string">'left'</span><span class="token punctuation">,</span>            toclevels<span class="token operator">:</span> <span class="token string">'3'</span><span class="token punctuation">,</span>            numbered<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>            sectlinks<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>            sectanchors<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>            hardbreaks<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>            generated<span class="token operator">:</span> asciiDocOutputDir    <span class="token punctuation">]</span><span class="token punctuation">}</span></code></pre><h3 id="4-ç¼–å†™ä¸€ä¸ªè‡ªå®šä¹‰taskç”¨æ¥æ‰§è¡Œä¸Šè¿°æµç¨‹ï¼š"><a href="#4-ç¼–å†™ä¸€ä¸ªè‡ªå®šä¹‰taskç”¨æ¥æ‰§è¡Œä¸Šè¿°æµç¨‹ï¼š" class="headerlink" title="4. ç¼–å†™ä¸€ä¸ªè‡ªå®šä¹‰taskç”¨æ¥æ‰§è¡Œä¸Šè¿°æµç¨‹ï¼š"></a>4. ç¼–å†™ä¸€ä¸ªè‡ªå®šä¹‰taskç”¨æ¥æ‰§è¡Œä¸Šè¿°æµç¨‹ï¼š</h3><pre class=" language-java"><code class="language-java">task <span class="token function">genPdf</span><span class="token punctuation">(</span>type<span class="token operator">:</span> Test<span class="token punctuation">,</span> dependsOn<span class="token operator">:</span> test<span class="token punctuation">)</span> <span class="token punctuation">{</span>    include <span class="token string">'**/*SwaggerTest.class'</span>    exclude <span class="token string">'**/*'</span>    <span class="token function">dependsOn</span><span class="token punctuation">(</span>asciidoctor<span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre><p>æ‰§è¡ŒgenPdfï¼Œå°±å¯ä»¥ç”ŸæˆSwaggerå¯¹åº”çš„PDFæ–‡ä»¶ã€‚</p><h3 id="5-å°ç»“"><a href="#5-å°ç»“" class="headerlink" title="5. å°ç»“"></a>5. å°ç»“</h3><p>ä½¿ç”¨æ­¤æ–¹æ³•æ­¥éª¤è¿˜æ˜¯æ¯”è¾ƒç¹ççš„ï¼Œæ€»ä½“æ¥è®²å°±æ˜¯json -&gt; adoc -&gt; pdfï¼Œå¹¶ä¸”ä½¿ç”¨æ­¤ç§æ–¹æ³•ç›®å‰æœ‰å‡ ä¸ªæ¯”è¾ƒå¤§çš„é—®é¢˜æˆ‘ä»ç„¶æ²¡æœ‰æ‰¾åˆ°è§£å†³æ–¹æ¡ˆï¼š</p><ul><li>ä»å®˜æ–¹æ–‡æ¡£ä¸­å¯ä»¥çœ‹åˆ°æ”¯æŒçš„è¯­è¨€é»˜è®¤æœ‰EN, DE, FR, RUã€‚æ²¡é”™ï¼Œä¸æ”¯æŒCNï¼Œä»å¯¼å‡ºçš„æ–‡æ¡£ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œéƒ¨åˆ†ä¸­æ–‡æ— æ³•æ˜¾ç¤ºï¼Œç›®å‰æˆ‘ä¹Ÿå°šæœªæ‰¾åˆ°æ˜¯å¦æœ‰é…ç½®å¯ä»¥å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚ç½‘ä¸Šçš„æ–‡ç« éƒ¨åˆ†æ˜¯é€šè¿‡æ›¿æ¢æºä»£ç åŒ…é‡Œé¢çš„å­—ä½“æ–‡ä»¶æ¥å®ç°ï¼Œä½†æ˜¯ç”±äºåé¢æœ‰æ›´å¥½çš„è§£å†³æ–¹æ¡ˆï¼Œè¿™é‡Œå°±ä¸å†è®¨è®ºã€‚</li><li>ä»asciidoctorj-pdfçš„<code>1.5.0-alpha.16</code>ç‰ˆæœ¬ä»¥åï¼ˆç›®å‰æœ€æ–°æ˜¯1.5.0-alpha.18ï¼‰ï¼Œè¿™ç§æ–¹å¼ç”Ÿæˆæ–‡ä»¶ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œæˆ‘ä¸ªäººå¹¶æ²¡æœ‰æ·±ç©¶è¿™ä¸ªå¼‚å¸¸ï¼Œæœ‰å…´è¶£çš„è¯»è€…å¯ä»¥é€šè¿‡ä¿®æ”¹ç‰ˆæœ¬å·è¯•ä¸€è¯•ã€‚</li><li>ç”Ÿæˆçš„adocæ–‡ä»¶ä¸€èˆ¬åŒ…å«overview.adocã€paths.adocã€definitions.adocã€security.adocä¸€å…±4ä¸ªæ–‡ä»¶ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè¦æ‰‹åŠ¨ç¼–å†™index.adocè¿›è¡Œæ•´åˆçš„åŸå› ï¼Œæ„Ÿè§‰ä¸å¤ªæ–¹ä¾¿ã€‚<br>ç»¼ä¸Šï¼Œæˆ‘ä¸ªäººå¹¶ä¸æ¨èé‡‡ç”¨æ­¤æ–¹å¼ç”ŸæˆPDFã€‚</li></ul><p>build.gradleå®Œæ•´æ–‡ä»¶å‚è€ƒï¼š</p><pre class=" language-java"><code class="language-java">buildscript <span class="token punctuation">{</span>    ext <span class="token punctuation">{</span>        springbootVersion <span class="token operator">=</span> <span class="token string">'2.1.6.RELEASE'</span>    <span class="token punctuation">}</span>    repositories <span class="token punctuation">{</span>        maven <span class="token punctuation">{</span>            url <span class="token string">'http://maven.aliyun.com/nexus/content/groups/public'</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    dependencies <span class="token punctuation">{</span>        classpath <span class="token string">"org.springframework.boot:spring-boot-gradle-plugin:${springbootVersion}"</span>        classpath <span class="token string">'org.asciidoctor:asciidoctor-gradle-plugin:1.5.3'</span>        classpath <span class="token string">'io.github.swagger2markup:swagger2markup-gradle-plugin:1.3.3'</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>repositories <span class="token punctuation">{</span>    maven <span class="token punctuation">{</span>        url <span class="token string">'http://maven.aliyun.com/nexus/content/groups/public'</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>apply plugin<span class="token operator">:</span> <span class="token string">'java'</span>apply plugin<span class="token operator">:</span> <span class="token string">'maven'</span>apply plugin<span class="token operator">:</span> <span class="token string">'org.springframework.boot'</span>apply plugin<span class="token operator">:</span> <span class="token string">'io.spring.dependency-management'</span>apply plugin<span class="token operator">:</span> <span class="token string">'io.github.swagger2markup'</span>apply plugin<span class="token operator">:</span> <span class="token string">'org.asciidoctor.convert'</span>group <span class="token string">'com.jptangchina'</span>version <span class="token string">'1.0-SNAPSHOT'</span>sourceCompatibility <span class="token operator">=</span> <span class="token number">1.8</span>targetCompatibility <span class="token operator">=</span> <span class="token number">1.8</span>ext <span class="token punctuation">{</span>    asciiDocOutputDir <span class="token operator">=</span> <span class="token function">file</span><span class="token punctuation">(</span><span class="token string">"${buildDir}/asciidoc"</span><span class="token punctuation">)</span>    swaggerOutputDir <span class="token operator">=</span> <span class="token function">file</span><span class="token punctuation">(</span><span class="token string">"${buildDir}/swagger"</span><span class="token punctuation">)</span>    swaggerVersion <span class="token operator">=</span> <span class="token string">'2.9.2'</span><span class="token punctuation">}</span>dependencies <span class="token punctuation">{</span>    compile <span class="token string">'org.springframework.boot:spring-boot-starter-web'</span>    compile <span class="token string">"io.springfox:springfox-swagger2:${swaggerVersion}"</span>    compile <span class="token string">"io.springfox:springfox-swagger-ui:${swaggerVersion}"</span>    compile <span class="token string">'io.github.swagger2markup:swagger2markup:1.3.3'</span>    asciidoctor <span class="token string">'org.asciidoctor:asciidoctorj-pdf:1.5.0-alpha.16'</span>    testCompile <span class="token string">'org.springframework.boot:spring-boot-starter-test'</span>    testCompile <span class="token string">'org.springframework.restdocs:spring-restdocs-mockmvc'</span><span class="token punctuation">}</span>test <span class="token punctuation">{</span>    systemProperty <span class="token string">'io.springfox.staticdocs.outputDir'</span><span class="token punctuation">,</span> swaggerOutputDir<span class="token punctuation">}</span>convertSwagger2markup <span class="token punctuation">{</span>    dependsOn test    swaggerInput <span class="token string">"${swaggerOutputDir}/swagger.json"</span>    outputDir asciiDocOutputDir    config <span class="token operator">=</span> <span class="token punctuation">[</span>            <span class="token string">'swagger2markup.pathsGroupedBy'</span> <span class="token operator">:</span> <span class="token string">'TAGS'</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span><span class="token punctuation">}</span>asciidoctor <span class="token punctuation">{</span>    dependsOn convertSwagger2markup    <span class="token function">sourceDir</span><span class="token punctuation">(</span>asciiDocOutputDir<span class="token punctuation">.</span>absolutePath<span class="token punctuation">)</span>    sources <span class="token punctuation">{</span>        include <span class="token string">"index.adoc"</span>    <span class="token punctuation">}</span>    backends <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'pdf'</span><span class="token punctuation">]</span>    attributes <span class="token operator">=</span> <span class="token punctuation">[</span>            doctype<span class="token operator">:</span> <span class="token string">'book'</span><span class="token punctuation">,</span>            toc<span class="token operator">:</span> <span class="token string">'left'</span><span class="token punctuation">,</span>            toclevels<span class="token operator">:</span> <span class="token string">'3'</span><span class="token punctuation">,</span>            numbered<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>            sectlinks<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>            sectanchors<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>            hardbreaks<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>            generated<span class="token operator">:</span> asciiDocOutputDir    <span class="token punctuation">]</span><span class="token punctuation">}</span>task <span class="token function">genPdf</span><span class="token punctuation">(</span>type<span class="token operator">:</span> Test<span class="token punctuation">,</span> dependsOn<span class="token operator">:</span> test<span class="token punctuation">)</span> <span class="token punctuation">{</span>    include <span class="token string">'**/*SwaggerTest.class'</span>    exclude <span class="token string">'**/*'</span>    <span class="token function">dependsOn</span><span class="token punctuation">(</span>asciidoctor<span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre><h2 id="ä½¿ç”¨asciidoctor-gradle-pluginç”ŸæˆPDFï¼ˆæ¨èï¼‰"><a href="#ä½¿ç”¨asciidoctor-gradle-pluginç”ŸæˆPDFï¼ˆæ¨èï¼‰" class="headerlink" title="ä½¿ç”¨asciidoctor-gradle-pluginç”ŸæˆPDFï¼ˆæ¨èï¼‰"></a>ä½¿ç”¨asciidoctor-gradle-pluginç”ŸæˆPDFï¼ˆæ¨èï¼‰</h2><p>asciidoctor-gradle-pluginä¹Ÿæ˜¯å®˜æ–¹æ¨èçš„ä½¿ç”¨æ–¹å¼ã€‚ç›¸å¯¹å‰é¢çš„æ–¹å¼ï¼Œä½¿ç”¨èµ·æ¥æ›´åŠ ç®€å•ï¼Œä¹Ÿå¯ä»¥ä¿®æ”¹é…ç½®è¾“å‡ºä¸­æ–‡ã€‚</p><h3 id="1-å¼•å…¥æ’ä»¶"><a href="#1-å¼•å…¥æ’ä»¶" class="headerlink" title="1. å¼•å…¥æ’ä»¶"></a>1. å¼•å…¥æ’ä»¶</h3><pre class=" language-java"><code class="language-java">plugins <span class="token punctuation">{</span>    id <span class="token string">'org.asciidoctor.jvm.pdf'</span> version <span class="token string">'2.2.0'</span><span class="token punctuation">}</span></code></pre><h3 id="2-ç¼–å†™æµ‹è¯•ç±»ç”Ÿæˆadoc"><a href="#2-ç¼–å†™æµ‹è¯•ç±»ç”Ÿæˆadoc" class="headerlink" title="2. ç¼–å†™æµ‹è¯•ç±»ç”Ÿæˆadoc"></a>2. ç¼–å†™æµ‹è¯•ç±»ç”Ÿæˆadoc</h3><p>ä¸ç¬¬ä¸€ä¸­æ–¹æ³•ä¸åŒçš„æ˜¯ï¼Œä¸éœ€è¦å†å°†jsonæ–‡ä»¶ä¿å­˜åˆ°æœ¬åœ°äº†ã€‚</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span>SpringRunner<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token annotation punctuation">@SpringBootTest</span><span class="token annotation punctuation">@AutoConfigureMockMvc</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SwaggerTest</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> MockMvc mockMvc<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">generateAsciiDocsToFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>        String outputDir <span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"io.springfox.staticdocs.outputDir"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        MvcResult mvcResult <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mockMvc<span class="token punctuation">.</span><span class="token function">perform</span><span class="token punctuation">(</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/v2/api-docs"</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>MediaType<span class="token punctuation">.</span>APPLICATION_JSON<span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isOk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">andReturn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Swagger2MarkupConfig config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Swagger2MarkupConfigBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">withMarkupLanguage</span><span class="token punctuation">(</span>MarkupLanguage<span class="token punctuation">.</span>ASCIIDOC<span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">withOutputLanguage</span><span class="token punctuation">(</span>Language<span class="token punctuation">.</span>ZH<span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">withPathsGroupedBy</span><span class="token punctuation">(</span>GroupBy<span class="token punctuation">.</span>TAGS<span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">withGeneratedExamples</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">withoutInlineSchema</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        MockHttpServletResponse response <span class="token operator">=</span> mvcResult<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        String swaggerJson <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getContentAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Swagger2MarkupConverter<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>swaggerJson<span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">withConfig</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">toFile</span><span class="token punctuation">(</span>Paths<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>outputDir <span class="token operator">+</span> <span class="token string">"/swagger"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><blockquote><p>æœ‰å…´è¶£çš„è¯»è€…å¯ä»¥é˜…è¯»ä¸‹toFileæ–¹æ³•çš„æºç ï¼Œé‡Œé¢å¯¹ç¬¬ä¸€ç§æ–¹æ³•ç”Ÿæˆçš„4ä¸ªæ–‡ä»¶è¿›è¡Œäº†æ•´åˆï¼Œè¿™ä¹Ÿæ˜¯ä¸å†éœ€è¦æ‰‹åŠ¨ç¼–å†™index.adocæ–‡ä»¶çš„åŸå› ã€‚</p></blockquote><h3 id="3-é…ç½®asciidoctorPdf"><a href="#3-é…ç½®asciidoctorPdf" class="headerlink" title="3. é…ç½®asciidoctorPdf"></a>3. é…ç½®asciidoctorPdf</h3><pre class=" language-java"><code class="language-java">ext <span class="token punctuation">{</span>    asciiDocOutputDir <span class="token operator">=</span> <span class="token function">file</span><span class="token punctuation">(</span><span class="token string">"${buildDir}/asciidoc"</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">// åˆ›å»ºå­—ä½“ä¸ä¸»é¢˜çš„æ–‡ä»¶å¤¹</span>    pdfFontsDir <span class="token operator">=</span> <span class="token function">file</span><span class="token punctuation">(</span><span class="token string">"${buildDir}/fonts"</span><span class="token punctuation">)</span>    pdfThemesDir <span class="token operator">=</span> <span class="token function">file</span><span class="token punctuation">(</span><span class="token string">"${buildDir}/themes"</span><span class="token punctuation">)</span>    swaggerVersion <span class="token operator">=</span> <span class="token string">'2.9.2'</span><span class="token punctuation">}</span>pdfThemes <span class="token punctuation">{</span>    local <span class="token string">'basic'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>        styleDir <span class="token operator">=</span> pdfThemesDir        <span class="token comment" spellcheck="true">// styleNameä¼šè¢«ç¨‹åºç”¨äºåŒ¹é…${styleName}-theme.ymlï¼Œå¦‚default-styleName-theme.yml</span>        styleName <span class="token operator">=</span> <span class="token string">'default'</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>asciidoctorPdf<span class="token punctuation">{</span>    <span class="token function">sourceDir</span><span class="token punctuation">(</span>asciiDocOutputDir<span class="token punctuation">.</span>absolutePath<span class="token punctuation">)</span>    sources <span class="token punctuation">{</span>        include <span class="token string">"swagger.adoc"</span>    <span class="token punctuation">}</span>    <span class="token function">fontsDir</span><span class="token punctuation">(</span>pdfFontsDir<span class="token punctuation">.</span>absolutePath<span class="token punctuation">)</span>    <span class="token function">theme</span><span class="token punctuation">(</span><span class="token string">"basic"</span><span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre><blockquote><p>æœ¬æ–‡å­—ä½“ä¸ä¸»é¢˜æ–‡ä»¶å‡æ¥è‡ªäº<code>asciidoctorj-pdf-1.5.0-alpha.18.jar</code>æºç åŒ…ï¼Œå…¶è·¯å¾„ä½äºï¼šgems/asciidoctorj-pdf-1.5.0-alpha.18/data</p></blockquote><h3 id="4-å¤åˆ¶å¹¶ä¿®æ”¹default-theme-ymlæ–‡ä»¶é…ç½®"><a href="#4-å¤åˆ¶å¹¶ä¿®æ”¹default-theme-ymlæ–‡ä»¶é…ç½®" class="headerlink" title="4. å¤åˆ¶å¹¶ä¿®æ”¹default-theme.ymlæ–‡ä»¶é…ç½®"></a>4. å¤åˆ¶å¹¶ä¿®æ”¹default-theme.ymlæ–‡ä»¶é…ç½®</h3><p>ä¸ºäº†è§£å†³ä¸­æ–‡æ— æ³•æ˜¾ç¤ºçš„é—®é¢˜ï¼Œé¦–å…ˆéœ€è¦è‡ªè¡Œä¸‹è½½ä¸€ä¸ªæ”¯æŒä¸­æ–‡çš„å­—ä½“æ–‡ä»¶ã€‚</p><p>ä¿®æ”¹ä¸»é¢˜æ–‡ä»¶ï¼Œå°†mplus1p-regular-fallback.ttfæ›¿æ¢ä¸ºè‡ªå·±ä¸‹è½½çš„å­—ä½“æ–‡ä»¶çš„åç§°ã€‚</p><pre class=" language-yml"><code class="language-yml">M+ 1p Fallback:  normal: your-font.ttf  bold: your-font.ttf  italic: your-font.ttf  bold_italic: your-font.ttf</code></pre><blockquote><p>ç”±äºæ‰‹åŠ¨æŒ‡å®šäº†å­—ä½“æ–‡ä»¶çš„è·¯å¾„ï¼Œæ‰€ä»¥é™¤äº†ä¸­æ–‡ä»¥å¤–ï¼Œè¿˜<strong>éœ€è¦å°†æºç ä¸­çš„å…¶ä»–å­—ä½“æ–‡ä»¶ä¸€å¹¶å¤åˆ¶åˆ°${pdfFontsDir}æ–‡ä»¶å¤¹</strong>ã€‚å¦‚æœä¸æ„¿æ„ä½¿ç”¨å®˜æ–¹çš„å­—ä½“ï¼Œä¹Ÿå¯ä»¥è€ƒè™‘å°†default-theme.ymlä¸­å…¶ä»–çš„å­—ä½“æ–‡ä»¶éƒ½ä¿®æ”¹ä¸ºè‡ªå·±æƒ³è¦çš„æ–‡ä»¶ã€‚</p></blockquote><p>ä¿æŒtask genPdfä¸å˜ï¼Œå†æ¬¡è¿è¡Œå³å¯ç”ŸæˆPDFæ–‡ä»¶ï¼Œç”Ÿæˆçš„æ–‡ä»¶é»˜è®¤è·¯å¾„ä¸º${build}/docs/asciidocPdf</p><h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>asciidoctor-gradle-pluginçš„æ–¹å¼å¯ä»¥æ”¯æŒé…ç½®å­—ä½“ä¸ä¸»é¢˜ï¼Œé€šè¿‡é…ç½®ä¸ä»…è§„é¿äº†ä¸­æ–‡æ— æ³•æ˜¾ç¤ºçš„é—®é¢˜ï¼ŒåŒæ—¶ä½¿ç”¨èµ·æ¥ä¹Ÿæ›´åŠ ç®€å•ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé‡‡ç”¨æ­¤ç§æ–¹æ¡ˆç”Ÿæˆå‡ºçš„æ–‡æ¡£ä¼šåœ¨å°é¢å†™æœ‰é¡¹ç›®çš„ç‰ˆæœ¬å·ï¼Œæ­¤ç‰ˆæœ¬å·ä¸ºbuild.gradleä¸­çš„versionï¼Œè€ŒéSwaggerConfigç±»ä¸­çš„versionã€‚</p><p>å®˜æ–¹æä¾›äº†å¾ˆå¤šé…ç½®ï¼Œå¯ä»¥è‡ªè¡Œå‚è€ƒå®˜æ–¹æ–‡æ¡£æŸ¥çœ‹ã€‚</p><p>build.gradleå®Œæ•´æ–‡ä»¶å‚è€ƒï¼š</p><pre class=" language-java"><code class="language-java">buildscript <span class="token punctuation">{</span>    ext <span class="token punctuation">{</span>        springbootVersion <span class="token operator">=</span> <span class="token string">'2.1.6.RELEASE'</span>    <span class="token punctuation">}</span>    repositories <span class="token punctuation">{</span>        maven <span class="token punctuation">{</span>            url <span class="token string">'http://maven.aliyun.com/nexus/content/groups/public'</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    dependencies <span class="token punctuation">{</span>        classpath <span class="token string">"org.springframework.boot:spring-boot-gradle-plugin:${springbootVersion}"</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>plugins <span class="token punctuation">{</span>    id <span class="token string">'org.asciidoctor.jvm.pdf'</span> version <span class="token string">'2.2.0'</span><span class="token punctuation">}</span>repositories <span class="token punctuation">{</span>    maven <span class="token punctuation">{</span>        url <span class="token string">'http://maven.aliyun.com/nexus/content/groups/public'</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>apply plugin<span class="token operator">:</span> <span class="token string">'java'</span>apply plugin<span class="token operator">:</span> <span class="token string">'maven'</span>apply plugin<span class="token operator">:</span> <span class="token string">'org.springframework.boot'</span>apply plugin<span class="token operator">:</span> <span class="token string">'io.spring.dependency-management'</span>group <span class="token string">'com.jptangchina'</span>version <span class="token string">'1.0-SNAPSHOT'</span>sourceCompatibility <span class="token operator">=</span> <span class="token number">1.8</span>targetCompatibility <span class="token operator">=</span> <span class="token number">1.8</span>ext <span class="token punctuation">{</span>    asciiDocOutputDir <span class="token operator">=</span> <span class="token function">file</span><span class="token punctuation">(</span><span class="token string">"${buildDir}/asciidoc"</span><span class="token punctuation">)</span>    pdfFontsDir <span class="token operator">=</span> <span class="token function">file</span><span class="token punctuation">(</span><span class="token string">"${buildDir}/fonts"</span><span class="token punctuation">)</span>    pdfThemesDir <span class="token operator">=</span> <span class="token function">file</span><span class="token punctuation">(</span><span class="token string">"${buildDir}/themes"</span><span class="token punctuation">)</span>    swaggerVersion <span class="token operator">=</span> <span class="token string">'2.9.2'</span><span class="token punctuation">}</span>dependencies <span class="token punctuation">{</span>    compile <span class="token string">'org.springframework.boot:spring-boot-starter-web'</span>    compile <span class="token string">"io.springfox:springfox-swagger2:${swaggerVersion}"</span>    compile <span class="token string">"io.springfox:springfox-swagger-ui:${swaggerVersion}"</span>    compile <span class="token string">'io.github.swagger2markup:swagger2markup:1.3.3'</span>    testCompile <span class="token string">'org.springframework.boot:spring-boot-starter-test'</span>    testCompile <span class="token string">'org.springframework.restdocs:spring-restdocs-mockmvc'</span><span class="token punctuation">}</span>test <span class="token punctuation">{</span>    systemProperty <span class="token string">'io.springfox.staticdocs.outputDir'</span><span class="token punctuation">,</span> asciiDocOutputDir<span class="token punctuation">}</span>pdfThemes <span class="token punctuation">{</span>    local <span class="token string">'basic'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>        styleDir <span class="token operator">=</span> pdfThemesDir        styleName <span class="token operator">=</span> <span class="token string">'default'</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>asciidoctorPdf<span class="token punctuation">{</span>    <span class="token function">sourceDir</span><span class="token punctuation">(</span>asciiDocOutputDir<span class="token punctuation">.</span>absolutePath<span class="token punctuation">)</span>    sources <span class="token punctuation">{</span>        include <span class="token string">"swagger.adoc"</span>    <span class="token punctuation">}</span>    <span class="token function">fontsDir</span><span class="token punctuation">(</span>pdfFontsDir<span class="token punctuation">.</span>absolutePath<span class="token punctuation">)</span>    <span class="token function">theme</span><span class="token punctuation">(</span><span class="token string">"basic"</span><span class="token punctuation">)</span><span class="token punctuation">}</span>task <span class="token function">genPdf</span><span class="token punctuation">(</span>type<span class="token operator">:</span> Test<span class="token punctuation">,</span> dependsOn<span class="token operator">:</span> test<span class="token punctuation">)</span> <span class="token punctuation">{</span>    include <span class="token string">'**/*SwaggerTest.class'</span>    exclude <span class="token string">'**/*'</span>    <span class="token function">dependsOn</span><span class="token punctuation">(</span>asciidoctorPdf<span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://github.com/Swagger2Markup/swagger2markup" target="_blank" rel="noopener">https://github.com/Swagger2Markup/swagger2markup</a><br><a href="https://github.com/Swagger2Markup/spring-swagger2markup-demo" target="_blank" rel="noopener">https://github.com/Swagger2Markup/spring-swagger2markup-demo</a><br><a href="http://swagger2markup.github.io/swagger2markup/1.3.3" target="_blank" rel="noopener">http://swagger2markup.github.io/swagger2markup/1.3.3</a></p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> gradle </tag>
            
            <tag> swagger </tag>
            
            <tag> swagger2markup </tag>
            
            <tag> asciidoctor </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>jxcel - å¥½ç”¨çš„Excelä¸Javaå¯¹è±¡è½¬æ¢å·¥å…·</title>
      <link href="/2019/06/13/jxcel-hao-yong-de-excel-yu-java-dui-xiang-zhuan-huan-gong-ju/"/>
      <url>/2019/06/13/jxcel-hao-yong-de-excel-yu-java-dui-xiang-zhuan-huan-gong-ju/</url>
      
        <content type="html"><![CDATA[<h2 id="Jxcelç®€ä»‹"><a href="#Jxcelç®€ä»‹" class="headerlink" title="Jxcelç®€ä»‹"></a>Jxcelç®€ä»‹</h2><p>Jxcelæ˜¯ä¸€ä¸ªæ”¯æŒJavaå¯¹è±¡ä¸Excelï¼ˆç›®å‰ä»…xlsxã€xlsï¼‰äº’ç›¸è½¬æ¢çš„å·¥å…·åŒ…ã€‚</p><p>é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/jptangchina/jxcel" target="_blank" rel="noopener">https://github.com/jptangchina/jxcel</a></p><h2 id="ç‰¹æ€§è¯´æ˜"><a href="#ç‰¹æ€§è¯´æ˜" class="headerlink" title="ç‰¹æ€§è¯´æ˜"></a>ç‰¹æ€§è¯´æ˜</h2><ul><li>Javaå¯¹è±¡è¾“å‡ºä¸ºExcelæ–‡ä»¶æˆ–Workbookå¯¹è±¡</li><li>è¯­ä¹‰åŒ–è½¬æ¢ï¼Œå°†æ•°å­—ç±»å‹æˆ–å¸ƒå°”ç±»å‹çš„å€¼ä¸è¯­ä¹‰åŒ–çš„å€¼äº’ç›¸è½¬æ¢</li><li>ç”Ÿæˆçš„Excelæ–‡ä»¶å¯ä»¥å¯¹åˆ—è¿›è¡Œæ’åº</li><li>è¡¨å¤´ä¸Javaå±æ€§ç²¾ç¡®åŒ¹é…</li><li>æ”¯æŒå‡ ä¹æ‰€æœ‰åŸºæœ¬æ•°æ®ç±»å‹ä»¥åŠæ—¥æœŸç±»å‹çš„è½¬æ¢</li><li>æ—¥æœŸæ ¼å¼è‡ªå®šä¹‰</li><li>è¡¨æ ¼å®½åº¦è‡ªé€‚åº”</li><li>â€¦â€¦æ›´å¤šç‰¹æ€§</li></ul><h2 id="å¼•å…¥ä¾èµ–åŒ…"><a href="#å¼•å…¥ä¾èµ–åŒ…" class="headerlink" title="å¼•å…¥ä¾èµ–åŒ…"></a>å¼•å…¥ä¾èµ–åŒ…</h2><p>ä»¥Mavenä¸ºä¾‹ï¼Œå¼•å…¥Jxcelä¾èµ–åŒ…ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.jptangchina<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>jxcel<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>${jxcel.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><h2 id="å‡†å¤‡æ•°æ®æ¨¡å‹"><a href="#å‡†å¤‡æ•°æ®æ¨¡å‹" class="headerlink" title="å‡†å¤‡æ•°æ®æ¨¡å‹"></a>å‡†å¤‡æ•°æ®æ¨¡å‹</h2><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Getter</span><span class="token annotation punctuation">@Setter</span><span class="token annotation punctuation">@AllArgsConstructor</span><span class="token annotation punctuation">@NoArgsConstructor</span><span class="token annotation punctuation">@JxcelSheet</span><span class="token punctuation">(</span><span class="token string">"å­¦ç”Ÿåå•"</span><span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">Student</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@JxcelCell</span><span class="token punctuation">(</span><span class="token string">"å¹´é¾„"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> age<span class="token punctuation">;</span>    <span class="token annotation punctuation">@JxcelCell</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"æ€§åˆ«"</span><span class="token punctuation">,</span> parse <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"ç”·"</span><span class="token punctuation">,</span> <span class="token string">"å¥³"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> sex<span class="token punctuation">;</span>    <span class="token annotation punctuation">@JxcelCell</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"å§“å"</span><span class="token punctuation">,</span> order <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>    <span class="token annotation punctuation">@JxcelCell</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"å‡ºç”Ÿæ—¥æœŸ"</span><span class="token punctuation">,</span> format <span class="token operator">=</span> <span class="token string">"yyyy-MM-dd"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> Date birthDay<span class="token punctuation">;</span>    <span class="token annotation punctuation">@JxcelCell</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"æ‰‹æœºå·"</span><span class="token punctuation">,</span> suffix <span class="token operator">=</span> <span class="token string">"\t"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> String mobile<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h2 id="å¯¼å‡ºæ•°æ®åˆ°Excel"><a href="#å¯¼å‡ºæ•°æ®åˆ°Excel" class="headerlink" title="å¯¼å‡ºæ•°æ®åˆ°Excel"></a>å¯¼å‡ºæ•°æ®åˆ°Excel</h2><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// å¯¼å‡ºä¸ºXLS Workbookå¯¹è±¡</span>JxcelGenrator<span class="token punctuation">.</span><span class="token function">xlsGenrator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">generateWorkbook</span><span class="token punctuation">(</span>Arrays<span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// å¯¼å‡ºä¸ºXLSX Workbookå¯¹è±¡</span>JxcelGenrator<span class="token punctuation">.</span><span class="token function">xlsxGenrator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">generateWorkbook</span><span class="token punctuation">(</span>Arrays<span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// å¯¼å‡ºä¸ºXLSæ–‡ä»¶</span>JxcelGenrator<span class="token punctuation">.</span><span class="token function">xlsGenrator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">generateFile</span><span class="token punctuation">(</span>Arrays<span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// å¯¼å‡ºä¸ºXLSXæ–‡ä»¶</span>JxcelGenrator<span class="token punctuation">.</span><span class="token function">xlsxGenrator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">generateFile</span><span class="token punctuation">(</span>Arrays<span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="å°†Excelè§£æä¸ºJavaå¯¹è±¡"><a href="#å°†Excelè§£æä¸ºJavaå¯¹è±¡" class="headerlink" title="å°†Excelè§£æä¸ºJavaå¯¹è±¡"></a>å°†Excelè§£æä¸ºJavaå¯¹è±¡</h2><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// ä»æ–‡ä»¶è§£æ</span>JxcelParser<span class="token punctuation">.</span><span class="token function">parser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parseFromFile</span><span class="token punctuation">(</span>Student<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// ä»Workboodå¯¹è±¡è§£æ</span>JxcelParser<span class="token punctuation">.</span><span class="token function">parser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parseFromWorkbook</span><span class="token punctuation">(</span>Student<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> workbook<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h2><pre class=" language-java"><code class="language-java">Student student <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"JptangChina"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"18510010000"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>JxcelGenrator<span class="token punctuation">.</span><span class="token function">xlsxGenrator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">generateFile</span><span class="token punctuation">(</span>Arrays<span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>student<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"/home/jptangchina/test.xlsx"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>è¾“å‡ºçš„è¡¨æ ¼å¦‚ä¸‹ï¼š</p><p><img src="https://s2.ax1x.com/2019/06/14/V4Zy8J.jpg" alt></p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> jxcel </tag>
            
            <tag> excel </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨SpringBoot JPAè¿›è¡Œè‡ªå®šä¹‰çš„ä¿å­˜åŠæ‰¹é‡ä¿å­˜</title>
      <link href="/2019/06/03/shi-yong-springboot-jpa-jin-xing-zi-ding-yi-de-bao-cun-ji-pi-liang-bao-cun/"/>
      <url>/2019/06/03/shi-yong-springboot-jpa-jin-xing-zi-ding-yi-de-bao-cun-ji-pi-liang-bao-cun/</url>
      
        <content type="html"><![CDATA[<h2 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h2><p>SpringBootç‰ˆæœ¬ï¼š2.1.4.RELEASE</p><p>javaç‰ˆæœ¬ï¼š1.8</p><p>æ–‡ä¸­æ‰€è¯´JPAçš†æŒ‡spring-boot-starter-data-jpa</p><h2 id="ä½¿ç”¨JPAä¿å­˜ä¸€ä¸ªStudentå¯¹è±¡"><a href="#ä½¿ç”¨JPAä¿å­˜ä¸€ä¸ªStudentå¯¹è±¡" class="headerlink" title="ä½¿ç”¨JPAä¿å­˜ä¸€ä¸ªStudentå¯¹è±¡"></a>ä½¿ç”¨JPAä¿å­˜ä¸€ä¸ªStudentå¯¹è±¡</h2><p>åœ¨JPAä¸­ä¿å­˜ä¸€ä¸ªå¯¹è±¡ï¼Œä»…éœ€è¦è¯¥å¯¹è±¡ï¼Œä¸€ä¸ªä»“å‚¨å³å¯ã€‚<br>StudentDOå®ä½“ç±»ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Getter</span><span class="token annotation punctuation">@Setter</span><span class="token annotation punctuation">@Entity</span><span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"t_student"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StudentDO</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Id</span>    <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy <span class="token operator">=</span> GenerationType<span class="token punctuation">.</span>IDENTITY<span class="token punctuation">)</span>    <span class="token annotation punctuation">@Column</span>    <span class="token keyword">private</span> Long id<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Column</span>    <span class="token keyword">private</span> String seq<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Column</span>    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Column</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> sex<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>JPAä»“å‚¨ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Repository</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">StudentRepo</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token operator">&lt;</span>StudentDO<span class="token punctuation">,</span> Long<span class="token operator">></span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre><p>ä¸€èˆ¬çš„ï¼Œæˆ‘ä»¬åªéœ€è¦è°ƒç”¨StudentRepo.save()æ–¹æ³•å³å¯å®Œæˆå¯¹å®ä½“å¯¹è±¡çš„ä¿å­˜æ“ä½œã€‚</p><pre class=" language-java"><code class="language-java">    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSave</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        StudentDO student <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StudentDO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        student<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"å¼ ä¸‰"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        student<span class="token punctuation">.</span><span class="token function">setSex</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        student<span class="token punctuation">.</span><span class="token function">setSeq</span><span class="token punctuation">(</span><span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        studentRepo<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>student<span class="token punctuation">)</span><span class="token punctuation">;</span>        Assert<span class="token punctuation">.</span><span class="token function">assertNotNull</span><span class="token punctuation">(</span>student<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span></code></pre><h2 id="åœ¨æ’å…¥è¿‡ç¨‹ä¸­ä½¿ç”¨mysqlå‡½æ•°"><a href="#åœ¨æ’å…¥è¿‡ç¨‹ä¸­ä½¿ç”¨mysqlå‡½æ•°" class="headerlink" title="åœ¨æ’å…¥è¿‡ç¨‹ä¸­ä½¿ç”¨mysqlå‡½æ•°"></a>åœ¨æ’å…¥è¿‡ç¨‹ä¸­ä½¿ç”¨mysqlå‡½æ•°</h2><p>å¦‚æœæˆ‘ä»¬å¸Œæœ›studentçš„seqå€¼ç”±ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆï¼Œä¸”ç”Ÿæˆè§„åˆ™ä¸ºâ€œyyMMdd + 8ä½è‡ªå¢åºåˆ—â€ï¼ˆä¾‹å¦‚19060310000000ï¼‰åˆè¯¥å¦‚ä½•å®ç°å‘¢ï¼Ÿ</p><p>é¦–å…ˆæƒ³åˆ°çš„æ˜¯è¯¥å¦‚ä½•ç”Ÿæˆè¿™ä¸€ä¸²åºåˆ—ï¼Œmysqlä¸åƒoracleè‡ªèº«æ”¯æŒsequenceï¼Œå› æ­¤åœ¨è¿™é‡Œå¯ä»¥å€Ÿç”¨å‡½æ•°ä»¥åŠé¢å¤–çš„sequenceè¡¨æ¥å®ç°è¿™ä¸€æ“ä½œï¼Œç½‘ä¸Šæœ‰å¾ˆå¤šå®ç°æ–¹å¼ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°ã€‚</p><p>ç°åœ¨å·²ç»æœ‰äº†å‡½æ•°getseq(â€˜student_seqâ€™)å¯ä»¥è·å–åˆ°è¯¥åºåˆ—ï¼Œè¯¥å¦‚ä½•å°†å…¶åº”ç”¨åˆ°ä¿å­˜å¯¹è±¡çš„æ–¹æ³•ä¸­ï¼Ÿæ˜¾ç„¶çš„ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œåƒä¸Šé¢é‚£æ ·å†ç›´æ¥è°ƒç”¨saveæ–¹æ³•å·²ç»è¡Œä¸é€šäº†ï¼Œåº”è¯¥å¾—éœ€è¦è‡ªå®šä¹‰æ’å…¥çš„sqlå®ç°ã€‚</p><p>ä¸€ä¸ªå®¹æ˜“æƒ³åˆ°çš„åŠæ³•æ˜¯ï¼Œåœ¨StudentDOç±»ä¸Šä½¿ç”¨æ³¨è§£@SQLInsertæ¥å®šä¹‰insertçš„å®ç°ï¼Œå®ƒå†™èµ·æ¥åº”è¯¥ä¼šåƒè¿™ä¸ªæ ·å­ï¼š</p><pre><code>@SQLInsert(sql = &quot;INSERT INTO t_student(seq, name, sex) VALUES (getseq(&#39;student_seq&#39;), ?, ?&quot;)</code></pre><p>è¿™æ¡sqlè¯­å¥æœ¬èº«å¹¶æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œå†æ¬¡è°ƒç”¨save()æ–¹æ³•ä¹Ÿç¡®å®èƒ½å¤Ÿæ‰§è¡Œã€‚ä½†æ˜¯å¾ˆå¯æƒœï¼Œå®ƒç¡®ä¼šæŠ›å‡ºä¸€ä¸ªsqlå¼‚å¸¸ï¼š</p><pre><code>java.sql.SQLException: Parameter index out of range (3 &gt; number of parameters, which is 2).</code></pre><p>æ˜¾ç„¶æ˜¯ç¨‹åºè®¤ä¸ºæœ‰å¤šå°‘ä¸ªå‚æ•°ï¼Œå°±å¾—æœ‰å¤šå°‘ä¸ªâ€œ?â€ä¸ä¹‹åŒ¹é…ï¼Œç›®å‰æˆ‘å¹¶æ²¡æœ‰æ‰¾åˆ°è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ¡ˆï¼Œæ‰€ä»¥è¿™ç§æ–¹æ³•å®£å‘Šå¤±è´¥ã€‚</p><p>æ—¢ç„¶@SQLInsertè¡Œä¸é€šï¼Œæˆ–è®¸å¯ä»¥è€ƒè™‘ä½¿ç”¨@Queryæ³¨è§£æ¥è‡ªå®šä¹‰ä¸€ä¸ªå®ç°ã€‚æˆ‘ä»¬å¯ä»¥åœ¨StudentRepoä¸­å®šä¹‰è¿™æ ·ä¸€ä¸ªæ–¹æ³•ï¼š</p><pre class=" language-java"><code class="language-java">    <span class="token annotation punctuation">@Transactional</span>    <span class="token annotation punctuation">@Modifying</span>    <span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"INSERT INTO t_student(seq, name, sex) VALUES (getseq('student_seq'), :#{#student.name}, :#{#student.sex})"</span><span class="token punctuation">,</span> nativeQuery <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>    <span class="token keyword">int</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"student"</span><span class="token punctuation">)</span> StudentDO student<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>è¯•ç€è¿è¡Œä¸€ä¸‹ï¼Œç»“æœå¾ˆæˆåŠŸï¼Œå¯¹è±¡è¢«æ­£å¸¸çš„å­˜å‚¨åˆ°æ•°æ®åº“ä¸­ï¼Œå¹¶ä¸”seqçš„å–å€¼ä¹Ÿæ­£å¸¸ã€‚çœ‹ä¸Šå»æˆ‘ä»¬çš„é—®é¢˜å·²ç»å¾—åˆ°äº†è§£å†³ï¼Œä½†äº‹å®çœŸçš„å¦‚æ­¤ä¹ˆï¼Ÿ</p><h2 id="è‡ªå®šä¹‰çš„æ‰¹é‡å­˜å‚¨"><a href="#è‡ªå®šä¹‰çš„æ‰¹é‡å­˜å‚¨" class="headerlink" title="è‡ªå®šä¹‰çš„æ‰¹é‡å­˜å‚¨"></a>è‡ªå®šä¹‰çš„æ‰¹é‡å­˜å‚¨</h2><p>ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æˆåŠŸé€šè¿‡JPAè°ƒç”¨äº†mysqlå‡½æ•°å°†å¯¹è±¡å­˜å‚¨åˆ°æ•°æ®åº“ä¸­ã€‚ä½†ä¸Šé¢çš„ä¾‹å­åªæä¾›äº†å•ä¸ªä¿å­˜çš„æ–¹æ³•ï¼Œå¦‚æœæˆ‘ä»¬æƒ³æ‰¹é‡ä¿å­˜å‘¢ï¼Ÿ@Queryé‡Œé¢çš„sqlèƒ½å¤Ÿè¿›è¡Œæ”¹é€ ä¹ˆï¼Ÿæˆ‘å¹¶æ²¡æœ‰æ‰¾åˆ°@Queryä¸­ä½¿ç”¨List<object>ä½œä¸ºå‚æ•°çš„insertæ–¹æ³•ï¼Œä½†æ˜¯è¿™å¹¶ä¸ä»£è¡¨è¿™ä¸€æ“ä½œä¸èƒ½æ‰§è¡Œã€‚JPAä»æ—§æä¾›ç»™äº†ä½¿ç”¨è€…åŸå§‹çš„ä½¿ç”¨æ–¹å¼ï¼šåˆ©ç”¨EntityManageræ¥æ„é€ sqlå¹¶æ‰§è¡Œã€‚</object></p><pre class=" language-java"><code class="language-java">    <span class="token annotation punctuation">@PersistenceContext</span>    <span class="token keyword">private</span> EntityManager entityManager<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> <span class="token function">batchInsert</span><span class="token punctuation">(</span>List<span class="token operator">&lt;</span>StudentDO<span class="token operator">></span> students<span class="token punctuation">)</span> <span class="token punctuation">{</span>        StringBuilder sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"INSERT INTO t_student(seq, name, sex) VALUES "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span>StudentDO student <span class="token operator">:</span> students<span class="token punctuation">)</span> <span class="token punctuation">{</span>            sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"(getseq('student_seq'), ?, ?),"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        String sql <span class="token operator">=</span> sb<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> sb<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Query query <span class="token operator">=</span> entityManager<span class="token punctuation">.</span><span class="token function">createNativeQuery</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> paramIndex <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span>StudentDO student <span class="token operator">:</span> students<span class="token punctuation">)</span> <span class="token punctuation">{</span>            query<span class="token punctuation">.</span><span class="token function">setParameter</span><span class="token punctuation">(</span>paramIndex<span class="token operator">++</span><span class="token punctuation">,</span> student<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            query<span class="token punctuation">.</span><span class="token function">setParameter</span><span class="token punctuation">(</span>paramIndex<span class="token operator">++</span><span class="token punctuation">,</span> student<span class="token punctuation">.</span><span class="token function">getSex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> query<span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span></code></pre><p>å°±åƒMyBatisä¸€æ ·ï¼Œä½¿ç”¨è€…ä¹Ÿå¯ä»¥è‡ªå®šä¹‰SQLæ¥æ‰§è¡Œï¼Œè¯•è¯•çœ‹ï¼ŒåŒæ ·æ²¡æœ‰é—®é¢˜ï¼Œå†å¤šçš„æ•°æ®ä¹Ÿå¯ä»¥è¢«ä¿å­˜åˆ°æ•°æ®åº“ä¸­ï¼æ‰¹é‡ä¿å­˜çš„æ•ˆæœè¾¾åˆ°äº†ã€‚</p><p>å†ä»”ç»†æƒ³ä¸€æƒ³ï¼Œé€šè¿‡ä¸Šé¢çš„è¿‡ç¨‹ï¼Œè¿˜æœ‰ä»€ä¹ˆé—®é¢˜ä¹ˆï¼Ÿå¯¹æ¯”JPAè‡ªå¸¦çš„save()æ–¹æ³•ï¼Œä¼¼ä¹æˆ‘ä»¬çš„è‡ªå®šä¹‰ä¿å­˜è¿”å›çš„éƒ½æ˜¯intç»“æœï¼Œä¹Ÿå°±æ˜¯æ“ä½œå½±å“çš„æ•°æ®åº“è¡Œæ•°ã€‚ä½¿ç”¨è¿‡JPAçš„äººéƒ½åº”è¯¥äº†è§£ï¼ŒJPAçš„save()æ–¹æ³•ï¼ˆæˆ–è€…å…¶ä»–JPAæ–¹æ³•ï¼‰è¿”å›çš„å¯¹è±¡æ˜¯ç»è¿‡æŒä¹…åŒ–çš„ï¼Œå¾—ç›Šäºè¿™ä¸€ç‰¹æ€§ï¼Œä½¿ç”¨è€…å¯ä»¥åœ¨è°ƒç”¨save()æ–¹æ³•ä¹‹åè·å–åˆ°å¯¹è±¡çš„idç­‰å¿…é¡»å…ˆæ’å…¥åˆ°æ•°æ®åº“ä¹‹åæ‰ä¼šæœ‰çš„å€¼ã€‚æ˜¾ç„¶è¿™é‡Œçš„æ“ä½œå·²ç»å¤±å»äº†è¿™ä¸€ç‰¹æ€§ï¼Œé‚£å¦‚æœæˆ‘ä»¬æŠŠè¿”å›å€¼å¯¹åº”çš„æ”¹ä¸ºObjectæˆ–è€…List<object>å¯ä»¥åšåˆ°ä¹ˆï¼Ÿç­”æ¡ˆæ˜¯å¹¶ä¸èƒ½ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°å¦‚ä¸‹å¼‚å¸¸ï¼š</object></p><pre class=" language-java"><code class="language-java">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>dao<span class="token punctuation">.</span>InvalidDataAccessApiUsageException<span class="token operator">:</span> Modifying queries can only use <span class="token keyword">void</span> or <span class="token keyword">int</span><span class="token operator">/</span>Integer as <span class="token keyword">return</span> type<span class="token operator">!</span><span class="token punctuation">;</span> nested exception is java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>IllegalArgumentException<span class="token operator">:</span> Modifying queries can only use <span class="token keyword">void</span> or <span class="token keyword">int</span><span class="token operator">/</span>Integer as <span class="token keyword">return</span> type<span class="token operator">!</span></code></pre><p>insertæ–¹æ³•å¿…é¡»ä½¿ç”¨@Modifyingè¿›è¡Œæ³¨è§£ï¼Œè€Œ@Modifyingæ³¨è§£çš„æ–¹æ³•åˆåªèƒ½è¿”å›intç±»å‹çš„ç»“æœã€‚è¿™ç§æƒ…å†µä¸‹æˆ–è®¸åªèƒ½å…ˆåˆ©ç”¨æŸ¥è¯¢å¾—åˆ°seqçš„å€¼å†è¿›è¡Œæ“ä½œã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å¯¹äºJPAçš„ä½¿ç”¨è¿˜ä¸å¤Ÿäº†è§£ï¼Œä¸€äº›å¤æ‚çš„æƒ…å†µä¸‹æ²¡æœ‰æ‰¾åˆ°æœ€ç†æƒ³çš„å®ç°æ–¹æ¡ˆã€‚</p><ol><li>@Queryæ³¨è§£ä¸­æ˜¯å¦èƒ½å¤Ÿä½¿ç”¨List<object>ä»¥åŠå®ç°åŠ¨æ€æ‹¼æ¥å‚æ•°çš„æ•ˆæœæ²¡æœ‰å¾—åˆ°è§£å†³</object></li><li>è‡ªå®šä¹‰çš„sqlè¯­å¥è¿”å›æŒä¹…åŒ–å¯¹è±¡çš„é—®é¢˜æ²¡æœ‰æ–¹æ¡ˆ</li></ol><p>åœ¨ä»¥åçš„ä½¿ç”¨äº†è§£ä¸­å¸Œæœ›èƒ½å¤Ÿæ‰¾åˆ°è§£å†³åŠæ³•ï¼Œå°†é—®é¢˜è®°å½•åœ¨è¿™é‡Œï¼Œä»¥ä¾¿åç»­æŸ¥çœ‹ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringBoot </tag>
            
            <tag> java </tag>
            
            <tag> JPA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2019/05/13/hello-world/"/>
      <url>/2019/05/13/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><pre class=" language-bash"><code class="language-bash">$ hexo new <span class="token string">"My New Post"</span></code></pre><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><pre class=" language-bash"><code class="language-bash">$ hexo server</code></pre><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><pre class=" language-bash"><code class="language-bash">$ hexo generate</code></pre><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><pre class=" language-bash"><code class="language-bash">$ hexo deploy</code></pre><p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
